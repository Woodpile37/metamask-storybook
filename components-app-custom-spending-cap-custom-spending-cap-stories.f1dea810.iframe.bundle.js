"use strict";(globalThis.webpackChunkmetamask_crx=globalThis.webpackChunkmetamask_crx||[]).push([[5198],{"./ui/components/app/custom-spending-cap/custom-spending-cap.stories.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{CustomSpendingCapStory:()=>CustomSpendingCapStory,DefaultStory:()=>DefaultStory,__namedExportsOrder:()=>__namedExportsOrder,default:()=>custom_spending_cap_stories});var react=__webpack_require__("./node_modules/react/index.js"),external_STORYBOOK_MODULE_CLIENT_API_=__webpack_require__("@storybook/client-api"),es=__webpack_require__("./node_modules/react-redux/es/index.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),bignumber=__webpack_require__("./node_modules/bignumber.js/bignumber.js"),bignumber_default=__webpack_require__.n(bignumber),dist_browser=__webpack_require__("./node_modules/ethereumjs-util/dist.browser/index.js"),i18n=__webpack_require__("./ui/contexts/i18n.js"),design_system=__webpack_require__("./ui/helpers/constants/design-system.ts"),component_library=__webpack_require__("./ui/components/component-library/index.ts"),app=__webpack_require__("./ui/ducks/app/app.ts"),transactions_controller_utils=__webpack_require__("./shared/lib/transactions-controller-utils.js"),conversion_utils=__webpack_require__("./shared/modules/conversion.utils.ts"),tokens=__webpack_require__("./shared/constants/tokens.js"),Numeric=__webpack_require__("./shared/modules/Numeric.ts"),actions=__webpack_require__("./ui/store/actions.ts"),dist=__webpack_require__("./node_modules/@metamask/transaction-controller/dist/index.js"),swaps_utils=__webpack_require__("./shared/lib/swaps-utils.js"),transaction_utils=__webpack_require__("./shared/modules/transaction.utils.js"),token_util=__webpack_require__("./ui/helpers/utils/token-util.js");var gasFee=__webpack_require__("./ui/contexts/gasFee.js"),zendesk_url=__webpack_require__("./ui/helpers/constants/zendesk-url.js"),tooltip=__webpack_require__("./ui/components/ui/tooltip/index.js");const CustomSpendingCapTooltip=({tooltipContentText,tooltipIcon})=>react.createElement(component_library.xu,{display:design_system.sS.InlineFlex,alignItems:design_system.g1.center},react.createElement(tooltip.Z,{interactive:!0,position:"top",html:react.createElement(component_library.xv,{variant:design_system.rK.bodySm,color:design_system.d9.textAlternative},tooltipContentText)},tooltipIcon?react.createElement(component_library.JO,{name:component_library.uH.Danger,size:component_library.Jh.Inherit,color:design_system.EY.errorDefault}):""!==tooltipIcon&&react.createElement(component_library.JO,{name:component_library.uH.Question,size:component_library.Jh.Inherit,color:design_system.EY.iconAlternative})));function CustomSpendingCap({txParams,tokenName,currentTokenBalance,dappProposedValue,siteOrigin,passTheErrorText,decimals,setInputChangeInProgress,customSpendingCap,setCustomSpendingCap}){const t=(0,react.useContext)(i18n.OO),dispatch=(0,es.I0)(),{updateTransaction}=(0,gasFee.YJ)(),inputRef=(0,react.useRef)(null),[error,setError]=(0,react.useState)(""),[showUseSiteSuggestionButton,setShowUseSiteSuggestionButton]=(0,react.useState)(customSpendingCap!==String(dappProposedValue)&&!0),inputLogicEmptyStateText=t("inputLogicEmptyState"),replaceCommaToDot=inputValue=>inputValue.replace(/,/gu,"."),decConversionGreaterThan=(tokenValue,tokenBalance)=>new Numeric.D(Number(replaceCommaToDot(tokenValue)),10).greaterThan(Number(tokenBalance),10),getInputTextLogic=inputNumber=>new Numeric.D(Number(replaceCommaToDot(inputNumber)),10).lessThanOrEqualTo(new Numeric.D(Number(currentTokenBalance),10))?{className:"custom-spending-cap__lowerValue",description:t("inputLogicEqualOrSmallerNumber",[react.createElement(component_library.xv,{key:"custom-spending-cap",variant:design_system.rK.bodySmBold,as:"span"},replaceCommaToDot(inputNumber)," ",tokenName)])}:decConversionGreaterThan(inputNumber,currentTokenBalance)?{className:"custom-spending-cap__higherValue",description:t("inputLogicHigherNumber")}:{className:"custom-spending-cap__emptyState",description:t("inputLogicEmptyState")},[customSpendingCapText,setCustomSpendingCapText]=(0,react.useState)(getInputTextLogic(customSpendingCap).description),handleChange=async valueInput=>{var _match$;if(!txParams)return;setInputChangeInProgress(!0);let spendingCapError="";const inputTextLogicDescription=getInputTextLogic(valueInput).description,match=tokens.BZ.exec(replaceCommaToDot(valueInput));if((null==match||null===(_match$=match[1])||void 0===_match$?void 0:_match$.length)>decimals)return void setInputChangeInProgress(!1);valueInput&&!tokens.d0.test(valueInput)?(spendingCapError=t("spendingCapError"),setCustomSpendingCapText(t("spendingCapErrorDescription",[siteOrigin])),setError(spendingCapError)):(setCustomSpendingCapText(inputTextLogicDescription),setError(""));const maxTokenAmount=(0,transactions_controller_utils.cp)(tokens.oc,decimals);if(Number(valueInput.length)>1&&Number(valueInput)){new(bignumber_default())(valueInput).greaterThan(maxTokenAmount)&&(spendingCapError=t("spendLimitTooLarge"),setError(spendingCapError))}if(setCustomSpendingCap(String(valueInput)),dispatch((0,app.sA)(String(valueInput))),""!==String(valueInput))try{const newData=function getCustomTxParamsData(data,{customPermissionAmount,decimals}){const tokenData=(0,transaction_utils.I1)(data);if(!tokenData)throw new Error("Invalid data");if(tokenData.name!==dist.TransactionType.tokenMethodApprove)throw new Error(`Invalid data; should be 'approve' method, but instead is '${tokenData.name}'`);let spender=(0,token_util.Qn)(tokenData);spender.startsWith("0x")&&(spender=spender.substring(2));const[signature,tokenValue]=data.split(spender);if(!signature||!tokenValue)throw new Error("Invalid data");if(64!==tokenValue.length)throw new Error("Invalid token value; should be exactly 64 hex digits long (u256)");let customPermissionValue=(0,conversion_utils.X0)((0,swaps_utils.wg)(customPermissionAmount,decimals));if(customPermissionValue.length>64)throw new Error("Custom value is larger than u256");return customPermissionValue=customPermissionValue.padStart(tokenValue.length,"0"),`${signature}${spender}${customPermissionValue}`}(txParams.data,{customPermissionAmount:valueInput,decimals}),{from,to,value:txValue}=txParams,estimatedGasLimit=await(0,actions.QH8)({from,to,value:txValue,data:newData});estimatedGasLimit&&await updateTransaction({gasLimit:(0,conversion_utils.Z8)((0,dist_browser.addHexPrefix)(estimatedGasLimit))})}catch(exp){console.error("Error in trying to update gas limit",exp)}setInputChangeInProgress(!1)};(0,react.useEffect)((()=>{customSpendingCap===String(dappProposedValue)?setShowUseSiteSuggestionButton(!1):setShowUseSiteSuggestionButton(!0)}),[customSpendingCap,dappProposedValue]),(0,react.useEffect)((()=>{passTheErrorText(error)}),[error,passTheErrorText]),(0,react.useEffect)((()=>{inputRef.current&&inputRef.current.focus({preventScroll:!0})}),[inputRef.current]);const chooseTooltipContentText=decConversionGreaterThan(customSpendingCap,currentTokenBalance)?t("warningTooltipText",[react.createElement(component_library.xv,{key:"tooltip-text",variant:design_system.rK.bodySmBold,as:"span",color:design_system.d9.errorDefault},react.createElement(component_library.JO,{name:component_library.uH.Danger,size:component_library.Jh.Inherit})," ",t("beCareful"))]):t("inputLogicEmptyState");return react.createElement(react.Fragment,null,react.createElement(component_library.xu,{className:"custom-spending-cap",display:design_system.sS.Flex,alignItems:design_system.g1.flexStart,flexDirection:design_system.Qb.Column,gap:2,padding:4,backgroundColor:design_system.lP.backgroundAlternative,borderRadius:design_system.$u.SM},react.createElement(component_library.xu,{display:design_system.sS.Flex,alignItems:design_system.g1.center,gap:1,width:design_system.Sw.Full},react.createElement("div",null,react.createElement(component_library.__,{htmlFor:"custom-spending-cap",display:design_system.sS.Inline,marginRight:1},t("customSpendingCap")),react.createElement(CustomSpendingCapTooltip,{tooltipContentText:replaceCommaToDot(customSpendingCap)?chooseTooltipContentText:"",tooltipIcon:replaceCommaToDot(customSpendingCap)?decConversionGreaterThan(customSpendingCap,currentTokenBalance):""})),showUseSiteSuggestionButton&&react.createElement(component_library.ZP,{marginLeft:"auto",size:design_system.$u.auto,onClick:e=>{e.preventDefault(),setShowUseSiteSuggestionButton(!1),handleChange(dappProposedValue)}},t("useSiteSuggestion"))),react.createElement(component_library.nv,{inputRef,inputProps:{"data-testid":"custom-spending-cap-input",color:decConversionGreaterThan(customSpendingCap,currentTokenBalance)?design_system.d9.errorDefault:design_system.d9.textDefault,paddingInlineEnd:4},id:"custom-spending-cap",onChange:e=>handleChange(e.target.value),placeholder:t("enterANumber"),value:customSpendingCap,endAccessory:react.createElement(component_library.ZP,{onClick:e=>{e.preventDefault(),handleChange(currentTokenBalance)},"data-testid":"custom-spending-cap-max-button"},t("max")),width:design_system.Sw.Full}),react.createElement(component_library.RU,{color:error?design_system.d9.errorDefault:design_system.d9.textDefault,variant:design_system.rK.bodySm},error||(replaceCommaToDot(customSpendingCap)?customSpendingCapText:inputLogicEmptyStateText)),react.createElement(component_library.ZP,{size:design_system.$u.SM,href:zendesk_url.Z.TOKEN_ALLOWANCE_WITH_SPENDING_CAP,externalLink:!0},t("learnMoreUpperCase"))))}var _DefaultStory$paramet,_DefaultStory$paramet2,_CustomSpendingCapSto,_CustomSpendingCapSto2;function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}CustomSpendingCapTooltip.propTypes={tooltipContentText:prop_types_default().oneOfType([prop_types_default().string,prop_types_default().node]),tooltipIcon:prop_types_default().oneOfType([prop_types_default().string,prop_types_default().bool])},CustomSpendingCapTooltip.__docgenInfo={description:"",methods:[],displayName:"CustomSpendingCapTooltip",props:{tooltipContentText:{description:"",type:{name:"union",value:[{name:"string"},{name:"node"}]},required:!1},tooltipIcon:{description:"",type:{name:"union",value:[{name:"string"},{name:"bool"}]},required:!1}}},CustomSpendingCap.propTypes={txParams:prop_types_default().object.isRequired,tokenName:prop_types_default().string,currentTokenBalance:prop_types_default().string,dappProposedValue:prop_types_default().string,siteOrigin:prop_types_default().string,passTheErrorText:prop_types_default().func,decimals:prop_types_default().string,setInputChangeInProgress:prop_types_default().func.isRequired,customSpendingCap:prop_types_default().string,setCustomSpendingCap:prop_types_default().func.isRequired},CustomSpendingCap.__docgenInfo={description:"",methods:[],displayName:"CustomSpendingCap",props:{txParams:{description:"Transaction params",type:{name:"object"},required:!0},tokenName:{description:"Displayed the token name currently tracked in description related to the input state",type:{name:"string"},required:!1},currentTokenBalance:{description:"The current token balance of the token",type:{name:"string"},required:!1},dappProposedValue:{description:"The dapp suggested amount",type:{name:"string"},required:!1},siteOrigin:{description:"The origin of the site generally the URL",type:{name:"string"},required:!1},passTheErrorText:{description:"Parent component's callback function passed in order to get the error text",type:{name:"func"},required:!1},decimals:{description:"Number of decimals",type:{name:"string"},required:!1},setInputChangeInProgress:{description:"Updating input state to changing",type:{name:"func"},required:!0},customSpendingCap:{description:"Custom token amount or The dapp suggested amount",type:{name:"string"},required:!1},setCustomSpendingCap:{description:"State method to update the custom token value",type:{name:"func"},required:!0}}};const custom_spending_cap_stories={title:"Components/App/CustomSpendingCap",argTypes:{txParams:{control:"object"},tokenName:{control:"text"},currentTokenBalance:{control:"text"},dappProposedValue:{control:"text"},siteOrigin:{control:"text"},passTheErrorText:{action:"passTheErrorText"},decimals:{control:"text"},setInputChangeInProgress:{action:"setInputChangeInProgress"},customSpendingCap:{control:"text"},setCustomSpendingCap:{action:"setCustomSpendingCap"}},args:{tokenName:"DAI",currentTokenBalance:"200.12",dappProposedValue:"7",siteOrigin:"Uniswap.org",decimals:"4",customSpendingCap:"7",txParams:{data:"0x095ea7b30000000000000000000000009bc5baf874d2da8d216ae9f137804184ee5afef40000000000000000000000000000000000000000000000000000000000011170",from:"0x8eeee1781fd885ff5ddef7789486676961873d12",gas:"0xb41b",maxFeePerGas:"0x4a817c800",maxPriorityFeePerGas:"0x4a817c800",to:"0x665933d73375e385bef40abcccea8b4cccc32d4c",value:"0x0"}}},Template=args=>{const[{customSpendingCap},updateArgs]=(0,external_STORYBOOK_MODULE_CLIENT_API_.useArgs)();return react.createElement(CustomSpendingCap,_extends({},args,{customSpendingCap,setCustomSpendingCap:value=>{updateArgs({customSpendingCap:value})}}))},DefaultStory=Template.bind({});DefaultStory.storyName="Default";const CustomSpendingCapStory=Template.bind({});CustomSpendingCapStory.storyName="CustomSpendingCap",CustomSpendingCapStory.args={customSpendingCap:"8"},DefaultStory.parameters={...DefaultStory.parameters,docs:{...null===(_DefaultStory$paramet=DefaultStory.parameters)||void 0===_DefaultStory$paramet?void 0:_DefaultStory$paramet.docs,source:{originalSource:"args => {\n  const [{\n    customSpendingCap\n  }, updateArgs] = useArgs();\n  const handleOnChange = value => {\n    updateArgs({\n      customSpendingCap: value\n    });\n  };\n  return <CustomSpendingCap {...args} customSpendingCap={customSpendingCap} setCustomSpendingCap={handleOnChange} />;\n}",...null===(_DefaultStory$paramet2=DefaultStory.parameters)||void 0===_DefaultStory$paramet2||null===(_DefaultStory$paramet2=_DefaultStory$paramet2.docs)||void 0===_DefaultStory$paramet2?void 0:_DefaultStory$paramet2.source}}},CustomSpendingCapStory.parameters={...CustomSpendingCapStory.parameters,docs:{...null===(_CustomSpendingCapSto=CustomSpendingCapStory.parameters)||void 0===_CustomSpendingCapSto?void 0:_CustomSpendingCapSto.docs,source:{originalSource:"args => {\n  const [{\n    customSpendingCap\n  }, updateArgs] = useArgs();\n  const handleOnChange = value => {\n    updateArgs({\n      customSpendingCap: value\n    });\n  };\n  return <CustomSpendingCap {...args} customSpendingCap={customSpendingCap} setCustomSpendingCap={handleOnChange} />;\n}",...null===(_CustomSpendingCapSto2=CustomSpendingCapStory.parameters)||void 0===_CustomSpendingCapSto2||null===(_CustomSpendingCapSto2=_CustomSpendingCapSto2.docs)||void 0===_CustomSpendingCapSto2?void 0:_CustomSpendingCapSto2.source}}};const __namedExportsOrder=["DefaultStory","CustomSpendingCapStory"]},"./ui/contexts/gasFee.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Po:()=>GasFeeContextProvider,YJ:()=>useGasFeeContext});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_2__),_hooks_gasFeeInput_useGasFeeInputs__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ui/hooks/gasFeeInput/useGasFeeInputs.js");const GasFeeContext=(0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)({}),GasFeeContextProvider=({children,defaultEstimateToUse,transaction,minimumGasLimit,editGasMode})=>{const gasFeeDetails=(0,_hooks_gasFeeInput_useGasFeeInputs__WEBPACK_IMPORTED_MODULE_1__.a)(defaultEstimateToUse,transaction,minimumGasLimit,editGasMode);return react__WEBPACK_IMPORTED_MODULE_0__.createElement(GasFeeContext.Provider,{value:gasFeeDetails},children)};function useGasFeeContext(){return(0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(GasFeeContext)}GasFeeContextProvider.propTypes={children:prop_types__WEBPACK_IMPORTED_MODULE_2___default().node.isRequired,defaultEstimateToUse:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string,transaction:prop_types__WEBPACK_IMPORTED_MODULE_2___default().object,minimumGasLimit:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string,editGasMode:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string},GasFeeContextProvider.__docgenInfo={description:"",methods:[],displayName:"GasFeeContextProvider",props:{children:{description:"",type:{name:"node"},required:!0},defaultEstimateToUse:{description:"",type:{name:"string"},required:!1},transaction:{description:"",type:{name:"object"},required:!1},minimumGasLimit:{description:"",type:{name:"string"},required:!1},editGasMode:{description:"",type:{name:"string"},required:!1}}}}}]);