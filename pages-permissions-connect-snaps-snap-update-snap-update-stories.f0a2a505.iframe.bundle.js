"use strict";(globalThis.webpackChunkmetamask_crx=globalThis.webpackChunkmetamask_crx||[]).push([[3289],{"./ui/pages/permissions-connect/snaps/snap-update/snap-update.stories.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DefaultStory:()=>DefaultStory,LoadingStory:()=>LoadingStory,ScrollingStory:()=>ScrollingStory,__namedExportsOrder:()=>__namedExportsOrder,default:()=>snap_update_stories});var _DefaultStory$paramet,_DefaultStory$paramet2,_DefaultStory$paramet3,_LoadingStory$paramet,_LoadingStory$paramet2,_LoadingStory$paramet3,_ScrollingStory$param,_ScrollingStory$param2,_ScrollingStory$param3,react=__webpack_require__("./node_modules/react/index.js"),es=__webpack_require__("./node_modules/react-redux/es/index.js"),store=__webpack_require__("./ui/store/store.ts"),mock_state=__webpack_require__("./test/data/mock-state.json"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),page_container=__webpack_require__("./ui/components/ui/page-container/index.js"),useI18nContext=__webpack_require__("./ui/hooks/useI18nContext.js"),snap_install_warning=__webpack_require__("./ui/components/app/snaps/snap-install-warning/index.js"),box=__webpack_require__("./ui/components/ui/box/box.js"),design_system=__webpack_require__("./ui/helpers/constants/design-system.ts"),update_snap_permission_list=__webpack_require__("./ui/components/app/snaps/update-snap-permission-list/update-snap-permission-list.js"),util=__webpack_require__("./ui/pages/permissions-connect/snaps/util.js"),pulse_loader=__webpack_require__("./ui/components/ui/pulse-loader/pulse-loader.js"),install_error=__webpack_require__("./ui/components/app/snaps/install-error/install-error.js"),snap_authorship_header=__webpack_require__("./ui/components/app/snaps/snap-authorship-header/index.js"),component_library=__webpack_require__("./ui/components/component-library/index.js"),useOriginMetadata=__webpack_require__("./ui/hooks/useOriginMetadata.js"),utils_util=__webpack_require__("./ui/helpers/utils/util.js"),useScrollRequired=__webpack_require__("./ui/hooks/useScrollRequired.js");function SnapUpdate({request,requestState,approveSnapUpdate,rejectSnapUpdate,targetSubjectMetadata}){var _request$metadata;const t=(0,useI18nContext.C)(),[isShowingWarning,setIsShowingWarning]=(0,react.useState)(!1),originMetadata=(0,useOriginMetadata.j)(null===(_request$metadata=request.metadata)||void 0===_request$metadata?void 0:_request$metadata.dappOrigin)||{},{isScrollable,isScrolledToBottom,scrollToBottom,ref,onScroll}=(0,useScrollRequired.s)([requestState]),onCancel=(0,react.useCallback)((()=>rejectSnapUpdate(request.metadata.id)),[request,rejectSnapUpdate]),onSubmit=(0,react.useCallback)((()=>approveSnapUpdate(request.metadata.id)),[request,approveSnapUpdate]),approvedPermissions=requestState.approvedPermissions??{},revokedPermissions=requestState.unusedPermissions??{},newPermissions=requestState.newPermissions??{},{newVersion}=requestState,isLoading=requestState.loading,hasError=!isLoading&&requestState.error,warnings=(0,util.Y)(newPermissions,targetSubjectMetadata,t),shouldShowWarning=warnings.length>0,snapName=(0,utils_util.NZ)(targetSubjectMetadata.origin,targetSubjectMetadata);return react.createElement(box.ZP,{className:"page-container snap-update",justifyContent:design_system.E0.spaceBetween,height:design_system.D8.FULL,borderStyle:design_system.N4.none,flexDirection:design_system.uM.COLUMN},react.createElement(snap_authorship_header.Z,{snapId:targetSubjectMetadata.origin}),react.createElement(box.ZP,{ref,onScroll,className:"snap-update__content",style:{overflowY:"auto",flex:!isLoading&&"1"}},!isLoading&&!hasError&&react.createElement(component_library.xv,{paddingBottom:4,paddingTop:4,variant:design_system.rK.headingLg,textAlign:"center"},t("snapUpdate")),isLoading&&react.createElement(box.ZP,{className:"snap-update__content__loader-container",flexDirection:design_system.uM.COLUMN,alignItems:design_system.g1.center,justifyContent:design_system.E0.center},react.createElement(pulse_loader.Z,null)),hasError&&react.createElement(install_error.Z,{iconName:component_library.uH.Warning,error:requestState.error,title:t("snapUpdateErrorTitle"),description:t("snapUpdateErrorDescription",[react.createElement(component_library.xv,{as:component_library.Tc.Span,key:"1",fontWeight:design_system.U9.Medium},snapName)])}),!hasError&&!isLoading&&react.createElement(react.Fragment,null,react.createElement(component_library.xv,{className:"snap-update__content__permission-description",paddingBottom:4,paddingLeft:4,paddingRight:4,textAlign:design_system.I8.CENTER},t("snapUpdateRequest",[react.createElement(component_library.xv,{as:component_library.Tc.Span,key:"1",variant:design_system.rK.bodyMd,fontWeight:design_system.U9.Medium},null==originMetadata?void 0:originMetadata.hostname),react.createElement(component_library.xv,{as:component_library.Tc.Span,key:"2",variant:design_system.rK.bodyMd,fontWeight:design_system.U9.Medium},snapName),react.createElement(component_library.xv,{as:component_library.Tc.Span,key:"3",variant:design_system.rK.bodyMd,fontWeight:design_system.U9.Medium},newVersion)])),react.createElement(update_snap_permission_list.Z,{approvedPermissions,revokedPermissions,newPermissions,targetSubjectMetadata}),isScrollable&&!isScrolledToBottom?react.createElement(component_library.fM,{className:"snap-install__scroll-button","data-testid":"snap-update-scroll",iconName:component_library.uH.Arrow2Down,backgroundColor:design_system.lP.infoDefault,color:design_system.EY.primaryInverse,onClick:scrollToBottom,style:{cursor:"pointer"}}):null)),react.createElement(box.ZP,{className:"snap-update__footer",alignItems:design_system.g1.center,flexDirection:design_system.uM.COLUMN,style:{boxShadow:"var(--shadow-size-lg) var(--color-shadow-default)"}},react.createElement(page_container.g$,{cancelButtonType:"default",hideCancel:hasError,disabled:isLoading||!hasError&&isScrollable&&!isScrolledToBottom,onCancel,cancelText:t("cancel"),onSubmit:()=>{!hasError&&shouldShowWarning?setIsShowingWarning(!0):hasError?onCancel():onSubmit()},submitText:t(hasError?"ok":"update")})),isShowingWarning&&react.createElement(snap_install_warning.Z,{onCancel:()=>setIsShowingWarning(!1),onSubmit,snapName,warnings}))}SnapUpdate.propTypes={request:prop_types_default().object.isRequired,requestState:prop_types_default().object.isRequired,approveSnapUpdate:prop_types_default().func.isRequired,rejectSnapUpdate:prop_types_default().func.isRequired,targetSubjectMetadata:prop_types_default().shape({iconUrl:prop_types_default().string,name:prop_types_default().string,origin:prop_types_default().string.isRequired,sourceCode:prop_types_default().string,version:prop_types_default().string}).isRequired},SnapUpdate.__docgenInfo={description:"",methods:[],displayName:"SnapUpdate",props:{request:{description:"",type:{name:"object"},required:!0},requestState:{description:"",type:{name:"object"},required:!0},approveSnapUpdate:{description:"",type:{name:"func"},required:!0},rejectSnapUpdate:{description:"",type:{name:"func"},required:!0},targetSubjectMetadata:{description:"",type:{name:"shape",value:{iconUrl:{name:"string",required:!1},name:{name:"string",required:!1},origin:{name:"string",required:!0},sourceCode:{name:"string",required:!1},version:{name:"string",required:!1}}},required:!0}}};const snap_update_stories_store=(0,store.Z)(mock_state),snap_update_stories={title:"Pages/Snaps/SnapUpdate",component:SnapUpdate,argTypes:{},decorators:[story=>react.createElement(es.zt,{store:snap_update_stories_store},story())]},DefaultStory=args=>react.createElement(SnapUpdate,args);DefaultStory.storyName="Default",DefaultStory.args={request:{metadata:{id:"foo"}},requestState:{loading:!1,newVersion:"2.0.0",approvedPermissions:{"endowment:rpc":{caveats:[{type:"rpcOrigin",value:{dapps:!0}}]},snap_dialog:{},snap_getBip44Entropy:{caveats:[{type:"permittedCoinTypes",value:[{coinType:1}]}]}}},targetSubjectMetadata:{origin:"npm:@metamask/test-snap-bip44"}};const LoadingStory=args=>react.createElement(SnapUpdate,args);LoadingStory.storyName="Loading",LoadingStory.args={request:{metadata:{id:"foo"}},requestState:{loading:!0},targetSubjectMetadata:{origin:"npm:@metamask/test-snap-bip44"}};const ScrollingStory=args=>react.createElement(SnapUpdate,args);ScrollingStory.storyName="Scrolling",ScrollingStory.args={request:{metadata:{id:"foo"}},requestState:{loading:!1,newVersion:"2.0.0",approvedPermissions:{"endowment:rpc":{caveats:[{type:"rpcOrigin",value:{dapps:!0}}]},"endowment:network-access":{},snap_notify:{},snap_dialog:{},snap_getBip44Entropy:{caveats:[{type:"permittedCoinTypes",value:[{coinType:1}]}]}}},targetSubjectMetadata:{origin:"npm:@metamask/test-snap-bip44"}},DefaultStory.parameters={...DefaultStory.parameters,docs:{...null===(_DefaultStory$paramet=DefaultStory.parameters)||void 0===_DefaultStory$paramet?void 0:_DefaultStory$paramet.docs,source:{originalSource:"args => <SnapUpdate {...args} />",...null===(_DefaultStory$paramet2=DefaultStory.parameters)||void 0===_DefaultStory$paramet2||null===(_DefaultStory$paramet3=_DefaultStory$paramet2.docs)||void 0===_DefaultStory$paramet3?void 0:_DefaultStory$paramet3.source}}},LoadingStory.parameters={...LoadingStory.parameters,docs:{...null===(_LoadingStory$paramet=LoadingStory.parameters)||void 0===_LoadingStory$paramet?void 0:_LoadingStory$paramet.docs,source:{originalSource:"args => <SnapUpdate {...args} />",...null===(_LoadingStory$paramet2=LoadingStory.parameters)||void 0===_LoadingStory$paramet2||null===(_LoadingStory$paramet3=_LoadingStory$paramet2.docs)||void 0===_LoadingStory$paramet3?void 0:_LoadingStory$paramet3.source}}},ScrollingStory.parameters={...ScrollingStory.parameters,docs:{...null===(_ScrollingStory$param=ScrollingStory.parameters)||void 0===_ScrollingStory$param?void 0:_ScrollingStory$param.docs,source:{originalSource:"args => <SnapUpdate {...args} />",...null===(_ScrollingStory$param2=ScrollingStory.parameters)||void 0===_ScrollingStory$param2||null===(_ScrollingStory$param3=_ScrollingStory$param2.docs)||void 0===_ScrollingStory$param3?void 0:_ScrollingStory$param3.source}}};const __namedExportsOrder=["DefaultStory","LoadingStory","ScrollingStory"];DefaultStory.__docgenInfo={description:"",methods:[],displayName:"DefaultStory"},LoadingStory.__docgenInfo={description:"",methods:[],displayName:"LoadingStory"},ScrollingStory.__docgenInfo={description:"",methods:[],displayName:"ScrollingStory"}},"./ui/components/app/snaps/snap-install-warning/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>SnapInstallWarning});var react=__webpack_require__("./node_modules/react/index.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),immer_esm=__webpack_require__("./node_modules/immer/dist/immer.esm.js"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),useI18nContext=__webpack_require__("./ui/hooks/useI18nContext.js"),check_box_component=__webpack_require__("./ui/components/ui/check-box/check-box.component.js"),design_system=__webpack_require__("./ui/helpers/constants/design-system.ts"),popover=__webpack_require__("./ui/components/ui/popover/index.js"),ui_button=__webpack_require__("./ui/components/ui/button/index.js"),component_library=__webpack_require__("./ui/components/component-library/index.js"),box=__webpack_require__("./ui/components/ui/box/box.js");const checkboxStateReducer=(0,immer_esm.produce)(((state,action)=>{if("check"!==action.type)throw new Error("You must provide a type when dispatching an action for checkboxState");state[action.checkboxId]=!state[action.checkboxId]||!state[action.checkboxId]}));function SnapInstallWarning({onCancel,onSubmit,warnings,snapName}){const t=(0,useI18nContext.C)(),[checkboxState,dispatch]=(0,react.useReducer)(checkboxStateReducer,{}),isAllChecked=warnings.every((warning=>checkboxState[warning.id])),onCheckboxClicked=(0,react.useCallback)((checkboxId=>{dispatch({type:"check",checkboxId})}),[]),SnapInstallWarningFooter=()=>react.createElement("div",{className:"snap-install-warning__footer"},react.createElement(ui_button.Z,{className:"snap-install-warning__footer-button",type:"primary",disabled:!isAllChecked,onClick:onSubmit},t("confirm")));return react.createElement(popover.Z,{className:"snap-install-warning",footer:react.createElement(SnapInstallWarningFooter,null),headerProps:{padding:[6,6,0]},contentProps:{paddingLeft:[6,4],paddingRight:[6,4],paddingTop:0,paddingBottom:[6,4]},footerProps:{padding:[4,6]},onClose:onCancel},react.createElement(box.ZP,{justifyContent:design_system.E0.center,marginBottom:6},react.createElement(component_library.fM,{iconName:component_library.uH.Danger,backgroundColor:design_system.lP.warningMuted,color:design_system.EY.warningDefault,size:design_system.$u.XL})),react.createElement(component_library.xv,{paddingBottom:6,textAlign:design_system.PH.Center,variant:design_system.rK.headingMd,as:"h2"},t("snapInstallWarningHeading")),react.createElement(component_library.xv,{paddingBottom:6,textAlign:design_system.PH.Center},warnings.length>1?t("snapInstallWarningCheckPlural",[react.createElement(component_library.xv,{key:"snapNameInWarningDescription",fontWeight:design_system.U9.Medium,as:"span"},snapName)]):t("snapInstallWarningCheck",[react.createElement(component_library.xv,{key:"snapNameInWarningDescription",fontWeight:design_system.U9.Medium,as:"span"},snapName)])),warnings.map(((warning,i)=>react.createElement("div",{className:classnames_default()("checkbox-label",{"checkbox-label--first":0===i}),key:warning.id},react.createElement(check_box_component.ZP,{checked:checkboxState[warning.id]??!1,id:warning.id,onClick:()=>onCheckboxClicked(warning.id)}),react.createElement("label",{htmlFor:warning.id},react.createElement(component_library.xv,{variant:design_system.rK.bodyMd},warning.message))))))}SnapInstallWarning.propTypes={onCancel:prop_types_default().func,onSubmit:prop_types_default().func,warnings:prop_types_default().arrayOf({message:prop_types_default().node,id:prop_types_default().string}),snapName:prop_types_default().string.isRequired},SnapInstallWarning.__docgenInfo={description:"",methods:[],displayName:"SnapInstallWarning",props:{onCancel:{description:"onCancel handler",type:{name:"func"},required:!1},onSubmit:{description:"onSubmit handler",type:{name:"func"},required:!1},warnings:{description:"warnings list",type:{name:"arrayOf",value:{name:"custom",raw:"{\n  message: PropTypes.node,\n  id: PropTypes.string,\n}"}},required:!1},snapName:{description:"Snap name",type:{name:"string"},required:!0}}}},"./ui/components/ui/check-box/check-box.component.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Km:()=>INDETERMINATE,ZP:()=>__WEBPACK_DEFAULT_EXPORT__,ri:()=>CHECKED,wT:()=>UNCHECKED});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_2__),classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__);const CHECKBOX_STATE={CHECKED:"CHECKED",INDETERMINATE:"INDETERMINATE",UNCHECKED:"UNCHECKED"},{CHECKED,INDETERMINATE,UNCHECKED}=CHECKBOX_STATE,CheckBox=({className,disabled,id,onClick,checked,title,dataTestId})=>{"boolean"==typeof checked&&(checked=checked?CHECKBOX_STATE.CHECKED:CHECKBOX_STATE.UNCHECKED);const ref=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);return(0,react__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)((()=>{ref.current.indeterminate=checked===CHECKBOX_STATE.INDETERMINATE}),[checked]),react__WEBPACK_IMPORTED_MODULE_0__.createElement("input",{checked:checked===CHECKBOX_STATE.CHECKED,className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("check-box",className,{"far fa-square":checked===CHECKBOX_STATE.UNCHECKED,"fa fa-check-square check-box__checked":checked===CHECKBOX_STATE.CHECKED,"fa fa-minus-square check-box__indeterminate":checked===CHECKBOX_STATE.INDETERMINATE}),disabled,id,onClick:onClick?event=>{event.preventDefault(),onClick()}:null,readOnly:!0,ref,title,"data-testid":dataTestId,type:"checkbox"})};CheckBox.propTypes={className:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string,disabled:prop_types__WEBPACK_IMPORTED_MODULE_2___default().bool,id:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string,onClick:prop_types__WEBPACK_IMPORTED_MODULE_2___default().func,checked:prop_types__WEBPACK_IMPORTED_MODULE_2___default().oneOf([...Object.keys(CHECKBOX_STATE),!0,!1]).isRequired,title:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string,dataTestId:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string},CheckBox.defaultProps={className:void 0,disabled:!1,id:void 0},CheckBox.__docgenInfo={description:"",methods:[],displayName:"CheckBox",props:{className:{defaultValue:{value:"undefined",computed:!0},description:"Add custom classname css",type:{name:"string"},required:!1},disabled:{defaultValue:{value:"false",computed:!1},description:"Check if checkbox disabled or not",type:{name:"bool"},required:!1},id:{defaultValue:{value:"undefined",computed:!0},description:"Checkbox ID",type:{name:"string"},required:!1},onClick:{description:"Click handler",type:{name:"func"},required:!1},checked:{description:"Check if the checkbox are checked or not",type:{name:"enum",value:[{value:"...Object.keys(CHECKBOX_STATE)",computed:!0},{value:"true",computed:!1},{value:"false",computed:!1}]},required:!0},title:{description:"Show title",type:{name:"string"},required:!1},dataTestId:{description:"Data test ID for checkbox Component",type:{name:"string"},required:!1}}};const __WEBPACK_DEFAULT_EXPORT__=CheckBox},"./ui/hooks/useOriginMetadata.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{j:()=>useOriginMetadata});var _metamask_subject_metadata_controller__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@metamask/subject-metadata-controller/dist/index.js"),react_redux__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react-redux/es/index.js"),_selectors__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ui/selectors/index.js");function useOriginMetadata(origin){const targetSubjectMetadata=(0,react_redux__WEBPACK_IMPORTED_MODULE_1__.v9)((state=>(0,_selectors__WEBPACK_IMPORTED_MODULE_2__.h5U)(state,origin)));if(!origin)return null;let minimumOriginMetadata=null;try{const url=new URL(origin);minimumOriginMetadata={host:url.host,hostname:url.hostname,origin,subjectType:_metamask_subject_metadata_controller__WEBPACK_IMPORTED_MODULE_0__.SubjectType.Unknown}}catch(_){}return targetSubjectMetadata&&minimumOriginMetadata?{...minimumOriginMetadata,...targetSubjectMetadata}:targetSubjectMetadata||minimumOriginMetadata}},"./ui/hooks/useScrollRequired.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{s:()=>useScrollRequired});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),lodash__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/lodash/lodash.js");const useScrollRequired=(dependencies=[])=>{const ref=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(),[isScrollableState,setIsScrollable]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1),[isScrolledToBottomState,setIsScrolledToBottom]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1),update=()=>{const isScrollable=ref.current&&ref.current.scrollHeight>ref.current.clientHeight,isScrolledToBottom=!isScrollable||Math.round(ref.current.scrollTop)+ref.current.offsetHeight>=ref.current.scrollHeight;setIsScrollable(isScrollable),setIsScrolledToBottom(isScrolledToBottom)};(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(update,[ref,...dependencies]);return{isScrollable:isScrollableState,isScrolledToBottom:isScrolledToBottomState,scrollToBottom:()=>{ref.current&&ref.current.scrollTo(0,ref.current.scrollHeight)},ref,onScroll:(0,lodash__WEBPACK_IMPORTED_MODULE_1__.debounce)(update,25)}}},"./ui/pages/permissions-connect/snaps/util.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Y:()=>getSnapInstallWarnings});var _helpers_utils_permission__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ui/helpers/utils/permission.js");function getSnapInstallWarnings(permissions,targetSubjectMetadata,t){return Object.entries(permissions).reduce(((filteredWarnings,[permissionName,permissionValue])=>{const permissionDescription=(0,_helpers_utils_permission__WEBPACK_IMPORTED_MODULE_0__.d7)({t,permissionName,permissionValue,targetSubjectMetadata});return filteredWarnings.concat(permissionDescription.filter((description=>1===description.weight)))}),[])}}}]);