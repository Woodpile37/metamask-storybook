"use strict";(globalThis.webpackChunkmetamask_crx=globalThis.webpackChunkmetamask_crx||[]).push([[3890],{"./ui/pages/settings/advanced-tab/advanced-tab.component.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>AdvancedTab});var prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),react=__webpack_require__("./node_modules/react/index.js"),metametrics=__webpack_require__("./shared/constants/metametrics.ts"),preferences=__webpack_require__("./shared/constants/preferences.ts"),component_library=__webpack_require__("./ui/components/component-library/index.ts"),ui_button=__webpack_require__("./ui/components/ui/button/index.js"),text_field=__webpack_require__("./ui/components/ui/text-field/index.js"),toggle_button=__webpack_require__("./ui/components/ui/toggle-button/index.js"),design_system=__webpack_require__("./ui/helpers/constants/design-system.ts"),Buffer=__webpack_require__("./node_modules/buffer/index.js").Buffer;const ExportableContentType_JSON="application/json",ExtensionForContentType={[ExportableContentType_JSON]:".json",["text/plain"]:".txt"};async function exportAsFile(filename,data,contentType){if(!ExtensionForContentType[contentType])throw new Error(`Unsupported file type: ${contentType}`);!function supportsShowSaveFilePicker(){return"undefined"!=typeof window&&void 0!==window.showSaveFilePicker&&void 0!==window.Blob}()?function saveFileUsingDataUri(filename,data,contentType){const b64=Buffer.from(data,"utf8").toString("base64"),elem=document.createElement("a");elem.href=`data:${contentType};Base64,${b64}`,elem.download=filename,document.body.appendChild(elem),elem.click(),document.body.removeChild(elem)}(filename,data,contentType):await async function saveFileUsingFilePicker(filename,data,contentType){const blob=new window.Blob([data],{contentType}),fileExtension=ExtensionForContentType[contentType],handle=await window.showSaveFilePicker({suggestedName:filename,types:[{description:filename,accept:{[contentType]:[fileExtension]}}]}),writable=await handle.createWritable();await writable.write(blob),await writable.close()}(filename,data,contentType)}var settings_search=__webpack_require__("./ui/helpers/utils/settings-search.js");function _defineProperty(obj,key,value){return(key=function _toPropertyKey(arg){var key=function _toPrimitive(input,hint){if("object"!=typeof input||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0!==prim){var res=prim.call(input,hint||"default");if("object"!=typeof res)return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===hint?String:Number)(input)}(arg,"string");return"symbol"==typeof key?key:String(key)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class AdvancedTab extends react.PureComponent{constructor(...args){super(...args),_defineProperty(this,"state",{autoLockTimeLimit:this.props.autoLockTimeLimit,autoLockTimeLimitBeforeNormalization:this.props.autoLockTimeLimit,lockTimeError:"",showResultMessage:!1,restoreSuccessful:!0,restoreMessage:null}),_defineProperty(this,"settingsRefs",Array((0,settings_search.Oc)(this.context.t,this.context.t("advanced"))).fill(void 0).map((()=>react.createRef()))),_defineProperty(this,"backupUserData",(async()=>{const{fileName,data}=await this.props.backupUserData();exportAsFile(fileName,data,ExportableContentType_JSON),this.context.trackEvent({event:"User Data Exported",category:"Backup",properties:{}})}))}componentDidUpdate(){const{t}=this.context;(0,settings_search.n4)(t,t("advanced"),this.settingsRefs)}componentDidMount(){const{t}=this.context;(0,settings_search.n4)(t,t("advanced"),this.settingsRefs)}async getTextFromFile(file){return new Promise(((resolve,reject)=>{const reader=new window.FileReader;reader.onload=e=>{const text=e.target.result;resolve(text)},reader.onerror=e=>{reject(e)},reader.readAsText(file)}))}async handleFileUpload(event){event.persist();const file=event.target.files[0],jsonString=await this.getTextFromFile(file);event.target.value="";try{const result=await this.props.restoreUserData(jsonString);this.setState({showResultMessage:!0,restoreSuccessful:result,restoreMessage:null})}catch(e){e.message.match(/Unexpected.+JSON/iu)&&this.setState({showResultMessage:!0,restoreSuccessful:!1,restoreMessage:"CORRUPT_JSON_FILE"})}}renderStateLogs(){const{t}=this.context,{displayWarning}=this.props;return react.createElement(component_library.xu,{className:"settings-page__content-row",display:design_system.sS.Flex,flexDirection:design_system.Qb.Column,ref:this.settingsRefs[0],"data-testid":"advanced-setting-state-logs"},react.createElement("div",{className:"settings-page__content-item"},react.createElement("span",null,t("stateLogs")),react.createElement("span",{className:"settings-page__content-description"},t("stateLogsDescription"))),react.createElement("div",{className:"settings-page__content-item"},react.createElement("div",{className:"settings-page__content-item-col"},react.createElement(ui_button.Z,{type:"secondary",large:!0,onClick:()=>{window.logStateString(((err,result)=>{err?displayWarning(t("stateLogError")):exportAsFile(`${t("stateLogFileName")}.json`,result,ExportableContentType_JSON)}))}},t("downloadStateLogs")))))}renderResetAccount(){const{t}=this.context,{showResetAccountConfirmationModal}=this.props;return react.createElement(component_library.xu,{ref:this.settingsRefs[1],className:"settings-page__content-row",display:design_system.sS.Flex,flexDirection:design_system.Qb.Column,"data-testid":"advanced-setting-reset-account"},react.createElement("div",{className:"settings-page__content-item"},react.createElement("span",null,t("clearActivity")),react.createElement("span",{className:"settings-page__content-description"},t("clearActivityDescription"))),react.createElement("div",{className:"settings-page__content-item"},react.createElement("div",{className:"settings-page__content-item-col"},react.createElement(ui_button.Z,{type:"danger",large:!0,className:"settings-tab__button--red",onClick:event=>{event.preventDefault(),this.context.trackEvent({category:metametrics.ci.Settings,event:metametrics.AW.AccountReset,properties:{}}),showResetAccountConfirmationModal()}},t("clearActivityButton")))))}renderHexDataOptIn(){const{t}=this.context,{sendHexData,setHexDataFeatureFlag}=this.props;return react.createElement(component_library.xu,{ref:this.settingsRefs[2],className:"settings-page__content-row",display:design_system.sS.Flex,flexDirection:design_system.Qb.Row,justifyContent:design_system.E0.spaceBetween,gap:4,"data-testid":"advanced-setting-hex-data"},react.createElement("div",{className:"settings-page__content-item"},react.createElement("span",null,t("showHexData")),react.createElement("div",{className:"settings-page__content-description"},t("showHexDataDescription"))),react.createElement("div",{className:"settings-page__content-item-col"},react.createElement(toggle_button.Z,{value:sendHexData,onToggle:value=>setHexDataFeatureFlag(!value),offLabel:t("off"),onLabel:t("on")})))}renderShowConversionInTestnets(){const{t}=this.context,{showFiatInTestnets,setShowFiatConversionOnTestnetsPreference}=this.props;return react.createElement(component_library.xu,{ref:this.settingsRefs[3],className:"settings-page__content-row",display:design_system.sS.Flex,flexDirection:design_system.Qb.Row,justifyContent:design_system.E0.spaceBetween,gap:4,"data-testid":"advanced-setting-show-testnet-conversion"},react.createElement("div",{className:"settings-page__content-item"},react.createElement("span",null,t("showFiatConversionInTestnets")),react.createElement("div",{className:"settings-page__content-description"},t("showFiatConversionInTestnetsDescription"))),react.createElement("div",{className:"settings-page__content-item-col"},react.createElement(toggle_button.Z,{value:showFiatInTestnets,onToggle:value=>setShowFiatConversionOnTestnetsPreference(!value),offLabel:t("off"),onLabel:t("on")})))}renderToggleTestNetworks(){const{t}=this.context,{showTestNetworks,setShowTestNetworks}=this.props;return react.createElement(component_library.xu,{ref:this.settingsRefs[4],className:"settings-page__content-row","data-testid":"advanced-setting-show-testnet-conversion",display:design_system.sS.Flex,flexDirection:design_system.Qb.Row,justifyContent:design_system.E0.spaceBetween,gap:4},react.createElement("div",{className:"settings-page__content-item"},react.createElement("span",null,t("showTestnetNetworks")),react.createElement("div",{className:"settings-page__content-description"},t("showTestnetNetworksDescription"))),react.createElement("div",{className:"settings-page__content-item-col"},react.createElement(toggle_button.Z,{value:showTestNetworks,onToggle:value=>setShowTestNetworks(!value),offLabel:t("off"),onLabel:t("on")})))}renderUseNonceOptIn(){const{t}=this.context,{useNonceField,setUseNonceField}=this.props;return react.createElement(component_library.xu,{ref:this.settingsRefs[5],className:"settings-page__content-row","data-testid":"advanced-setting-custom-nonce",display:design_system.sS.Flex,flexDirection:design_system.Qb.Row,justifyContent:design_system.E0.spaceBetween,gap:4},react.createElement("div",{className:"settings-page__content-item"},react.createElement("span",null,t("nonceField")),react.createElement("div",{className:"settings-page__content-description"},t("nonceFieldDescription"))),react.createElement("div",{className:"settings-page__content-item-col"},react.createElement(toggle_button.Z,{value:useNonceField,onToggle:value=>setUseNonceField(!value),offLabel:t("off"),onLabel:t("on")})))}renderAutoLockTimeLimit(){const{t}=this.context,{lockTimeError}=this.state,{setAutoLockTimeLimit}=this.props;return react.createElement(component_library.xu,{ref:this.settingsRefs[6],className:"settings-page__content-row","data-testid":"advanced-setting-auto-lock",display:design_system.sS.Flex,flexDirection:design_system.Qb.Column},react.createElement("div",{className:"settings-page__content-item"},react.createElement("span",null,t("autoLockTimeLimit")),react.createElement("div",{className:"settings-page__content-description"},t("autoLockTimeLimitDescription"))),react.createElement("div",{className:"settings-page__content-item"},react.createElement("div",{className:"settings-page__content-item-col"},react.createElement(text_field.Z,{id:"autoTimeout","data-testid":"auto-lockout-time",placeholder:"0",value:this.state.autoLockTimeLimitBeforeNormalization,onChange:e=>this.handleLockChange(e.target.value),error:lockTimeError,fullWidth:!0,margin:"dense",min:0}),react.createElement(ui_button.Z,{type:"primary","data-testid":"auto-lockout-button",className:"settings-tab__rpc-save-button",disabled:""!==lockTimeError,onClick:()=>{setAutoLockTimeLimit(this.state.autoLockTimeLimit)}},t("save")))))}renderDismissSeedBackupReminderControl(){const{t}=this.context,{dismissSeedBackUpReminder,setDismissSeedBackUpReminder}=this.props;return react.createElement(component_library.xu,{ref:this.settingsRefs[8],className:"settings-page__content-row","data-testid":"advanced-setting-dismiss-reminder",display:design_system.sS.Flex,flexDirection:design_system.Qb.Row,justifyContent:design_system.E0.spaceBetween,gap:4},react.createElement("div",{className:"settings-page__content-item"},react.createElement("span",null,t("dismissReminderField")),react.createElement("div",{className:"settings-page__content-description"},t("dismissReminderDescriptionField"))),react.createElement("div",{className:"settings-page__content-item-col"},react.createElement(toggle_button.Z,{value:dismissSeedBackUpReminder,onToggle:value=>setDismissSeedBackUpReminder(!value),offLabel:t("off"),onLabel:t("on")})))}renderToggleEthSignControl(){const{t,trackEvent}=this.context,{disabledRpcMethodPreferences,showEthSignModal,setDisabledRpcMethodPreference}=this.props;return react.createElement(component_library.xu,{ref:this.settingsRefs[9],className:"settings-page__content-row","data-testid":"advanced-setting-toggle-ethsign",display:design_system.sS.Flex,flexDirection:design_system.Qb.Column},react.createElement("div",{className:"settings-page__content-item"},react.createElement("span",null,t("toggleEthSignField")),react.createElement("div",{className:"settings-page__content-description"},t("toggleEthSignDescriptionField"))),null!=disabledRpcMethodPreferences&&disabledRpcMethodPreferences.eth_sign?react.createElement(component_library.wB,{severity:design_system.zb.Danger,marginTop:3,marginBottom:4,descriptionProps:{variant:design_system.rK.bodyMd}},t("toggleEthSignBannerDescription")):null,react.createElement("div",{className:"settings-page__content-item-col"},react.createElement(toggle_button.Z,{className:"eth-sign-toggle",value:(null==disabledRpcMethodPreferences?void 0:disabledRpcMethodPreferences.eth_sign)||!1,onToggle:value=>{value?(value=>{setDisabledRpcMethodPreference("eth_sign",!value),trackEvent({category:metametrics.ci.Settings,event:metametrics.AW.OnboardingWalletAdvancedSettings,properties:{location:"Settings",enable_eth_sign:!1}})})(value):showEthSignModal()},offLabel:t("toggleEthSignOff"),onLabel:t("toggleEthSignOn")})))}handleLockChange(autoLockTimeLimitBeforeNormalization){const{t}=this.context;if(""===autoLockTimeLimitBeforeNormalization)return void this.setState({autoLockTimeLimitBeforeNormalization,autoLockTimeLimit:preferences.$.toString(),lockTimeError:""});const autoLockTimeLimitAfterNormalization=Number(autoLockTimeLimitBeforeNormalization);if(Number.isNaN(autoLockTimeLimitAfterNormalization)||autoLockTimeLimitAfterNormalization<0||autoLockTimeLimitAfterNormalization>10080)return void this.setState({autoLockTimeLimitBeforeNormalization,autoLockTimeLimit:null,lockTimeError:t("lockTimeInvalid")});const autoLockTimeLimit=autoLockTimeLimitAfterNormalization;this.setState({autoLockTimeLimitBeforeNormalization,autoLockTimeLimit,lockTimeError:""})}renderUserDataBackup(){const{t}=this.context;return react.createElement(component_library.xu,{ref:this.settingsRefs[10],className:"settings-page__content-row","data-testid":"advanced-setting-data-backup",display:design_system.sS.Flex,flexDirection:design_system.Qb.Column},react.createElement("div",{className:"settings-page__content-item"},react.createElement("span",null,t("backupUserData")),react.createElement("span",{className:"settings-page__content-description"},t("backupUserDataDescription"))),react.createElement("div",{className:"settings-page__content-item"},react.createElement("div",{className:"settings-page__content-item-col"},react.createElement(ui_button.Z,{"data-testid":"backup-button",type:"secondary",large:!0,onClick:()=>this.backupUserData()},t("backup")))))}renderRestoreUserData(){const{t}=this.context,{showResultMessage,restoreSuccessful,restoreMessage}=this.state,defaultRestoreMessage=t(restoreSuccessful?"restoreSuccessful":"restoreFailed"),restoreMessageToRender="CORRUPT_JSON_FILE"===restoreMessage?t("dataBackupSeemsCorrupt"):defaultRestoreMessage;return react.createElement(component_library.xu,{ref:this.settingsRefs[11],className:"settings-page__content-row","data-testid":"advanced-setting-data-restore",display:design_system.sS.Flex,flexDirection:design_system.Qb.Column},react.createElement("div",{className:"settings-page__content-item"},react.createElement("span",null,t("restoreUserData")),react.createElement("span",{className:"settings-page__content-description"},t("restoreUserDataDescription"))),react.createElement("div",{className:"settings-page__content-item"},react.createElement("div",{className:"settings-page__content-item-col"},react.createElement("label",{htmlFor:"restore-file",className:"button btn btn--rounded btn-secondary btn--large settings-page__button"},t("restore")),react.createElement("input",{id:"restore-file","data-testid":"restore-file",style:{visibility:"hidden"},type:"file",accept:".json",onChange:e=>this.handleFileUpload(e)})),showResultMessage&&react.createElement(component_library.wB,{severity:restoreSuccessful?component_library.eV.Success:component_library.eV.Danger,description:restoreMessageToRender,descriptionProps:{"data-testid":"restore-user-data-banner-alert-description"},actionButtonLabel:t("dismiss"),actionButtonOnClick:()=>{this.setState({showResultMessage:!1,restoreSuccessful:!0,restoreMessage:null})}})))}render(){const{warning}=this.props;return react.createElement("div",{className:"settings-page__body"},warning?react.createElement("div",{className:"settings-tab__error"},warning):null,this.renderStateLogs(),this.renderResetAccount(),this.renderHexDataOptIn(),this.renderShowConversionInTestnets(),this.renderToggleTestNetworks(),this.renderUseNonceOptIn(),this.renderAutoLockTimeLimit(),this.renderUserDataBackup(),this.renderRestoreUserData(),this.renderDismissSeedBackupReminderControl(),this.renderToggleEthSignControl())}}_defineProperty(AdvancedTab,"contextTypes",{t:prop_types_default().func,trackEvent:prop_types_default().func}),_defineProperty(AdvancedTab,"propTypes",{setUseNonceField:prop_types_default().func,useNonceField:prop_types_default().bool,setHexDataFeatureFlag:prop_types_default().func,displayWarning:prop_types_default().func,showResetAccountConfirmationModal:prop_types_default().func,showEthSignModal:prop_types_default().func,warning:prop_types_default().string,sendHexData:prop_types_default().bool,showFiatInTestnets:prop_types_default().bool,showTestNetworks:prop_types_default().bool,autoLockTimeLimit:prop_types_default().number,setAutoLockTimeLimit:prop_types_default().func.isRequired,setShowFiatConversionOnTestnetsPreference:prop_types_default().func.isRequired,setShowTestNetworks:prop_types_default().func.isRequired,setDismissSeedBackUpReminder:prop_types_default().func.isRequired,dismissSeedBackUpReminder:prop_types_default().bool.isRequired,backupUserData:prop_types_default().func.isRequired,restoreUserData:prop_types_default().func.isRequired,setDisabledRpcMethodPreference:prop_types_default().func.isRequired,disabledRpcMethodPreferences:prop_types_default().shape({eth_sign:prop_types_default().bool.isRequired})}),AdvancedTab.__docgenInfo={description:"",methods:[{name:"getTextFromFile",docblock:null,modifiers:["async"],params:[{name:"file",type:null}],returns:null},{name:"handleFileUpload",docblock:null,modifiers:["async"],params:[{name:"event",type:null}],returns:null},{name:"backupUserData",docblock:null,modifiers:["async"],params:[],returns:null},{name:"renderStateLogs",docblock:null,modifiers:[],params:[],returns:null},{name:"renderResetAccount",docblock:null,modifiers:[],params:[],returns:null},{name:"renderHexDataOptIn",docblock:null,modifiers:[],params:[],returns:null},{name:"renderShowConversionInTestnets",docblock:null,modifiers:[],params:[],returns:null},{name:"renderToggleTestNetworks",docblock:null,modifiers:[],params:[],returns:null},{name:"renderUseNonceOptIn",docblock:null,modifiers:[],params:[],returns:null},{name:"renderAutoLockTimeLimit",docblock:null,modifiers:[],params:[],returns:null},{name:"renderDismissSeedBackupReminderControl",docblock:null,modifiers:[],params:[],returns:null},{name:"renderToggleEthSignControl",docblock:null,modifiers:[],params:[],returns:null},{name:"handleLockChange",docblock:null,modifiers:[],params:[{name:"autoLockTimeLimitBeforeNormalization",type:null}],returns:null},{name:"renderUserDataBackup",docblock:null,modifiers:[],params:[],returns:null},{name:"renderRestoreUserData",docblock:null,modifiers:[],params:[],returns:null}],displayName:"AdvancedTab",props:{setUseNonceField:{description:"",type:{name:"func"},required:!1},useNonceField:{description:"",type:{name:"bool"},required:!1},setHexDataFeatureFlag:{description:"",type:{name:"func"},required:!1},displayWarning:{description:"",type:{name:"func"},required:!1},showResetAccountConfirmationModal:{description:"",type:{name:"func"},required:!1},showEthSignModal:{description:"",type:{name:"func"},required:!1},warning:{description:"",type:{name:"string"},required:!1},sendHexData:{description:"",type:{name:"bool"},required:!1},showFiatInTestnets:{description:"",type:{name:"bool"},required:!1},showTestNetworks:{description:"",type:{name:"bool"},required:!1},autoLockTimeLimit:{description:"",type:{name:"number"},required:!1},setAutoLockTimeLimit:{description:"",type:{name:"func"},required:!0},setShowFiatConversionOnTestnetsPreference:{description:"",type:{name:"func"},required:!0},setShowTestNetworks:{description:"",type:{name:"func"},required:!0},setDismissSeedBackUpReminder:{description:"",type:{name:"func"},required:!0},dismissSeedBackUpReminder:{description:"",type:{name:"bool"},required:!0},backupUserData:{description:"",type:{name:"func"},required:!0},restoreUserData:{description:"",type:{name:"func"},required:!0},setDisabledRpcMethodPreference:{description:"",type:{name:"func"},required:!0},disabledRpcMethodPreferences:{description:"",type:{name:"shape",value:{eth_sign:{name:"bool",required:!0}}},required:!1}},context:{t:{type:{name:"func"},required:!1},trackEvent:{type:{name:"func"},required:!1}}}}}]);