"use strict";(globalThis.webpackChunkmetamask_crx=globalThis.webpackChunkmetamask_crx||[]).push([[1819],{"./ui/helpers/constants/gas.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{IT:()=>GAS_FORM_ERRORS,K7:()=>PRIORITY_LEVEL_ICON_MAP,V3:()=>getGasFormErrorText});const GAS_FORM_ERRORS={GAS_LIMIT_OUT_OF_BOUNDS:"editGasLimitOutOfBounds",MAX_PRIORITY_FEE_TOO_LOW:"editGasMaxPriorityFeeLow",MAX_FEE_TOO_LOW:"editGasMaxFeeLow",MAX_PRIORITY_FEE_BELOW_MINIMUM:"editGasMaxPriorityFeeBelowMinimum",MAX_PRIORITY_FEE_HIGH_WARNING:"editGasMaxPriorityFeeHigh",MAX_FEE_HIGH_WARNING:"editGasMaxFeeHigh",MAX_FEE_IMBALANCE:"editGasMaxFeeImbalance",GAS_PRICE_TOO_LOW:"editGasPriceTooLow"};function getGasFormErrorText(type,t,{minimumGasLimit}={}){switch(type){case GAS_FORM_ERRORS.GAS_LIMIT_OUT_OF_BOUNDS:return t("editGasLimitOutOfBounds",[minimumGasLimit]);case GAS_FORM_ERRORS.MAX_PRIORITY_FEE_TOO_LOW:return t("editGasMaxPriorityFeeLow");case GAS_FORM_ERRORS.MAX_FEE_TOO_LOW:return t("editGasMaxFeeLow");case GAS_FORM_ERRORS.MAX_PRIORITY_FEE_BELOW_MINIMUM:return t("editGasMaxPriorityFeeBelowMinimum");case GAS_FORM_ERRORS.MAX_PRIORITY_FEE_HIGH_WARNING:return t("editGasMaxPriorityFeeHigh");case GAS_FORM_ERRORS.MAX_FEE_HIGH_WARNING:return t("editGasMaxFeeHigh");case GAS_FORM_ERRORS.MAX_FEE_IMBALANCE:return t("editGasMaxFeePriorityImbalance");case GAS_FORM_ERRORS.GAS_PRICE_TOO_LOW:return t("editGasPriceTooLow");default:return""}}const PRIORITY_LEVEL_ICON_MAP={low:"ðŸ¢",medium:"ðŸ¦Š",high:"ðŸ¦",dappSuggested:"ðŸŒ",dappSuggestedHigh:"ðŸŒ",swapSuggested:"ðŸ”„",custom:"âš™ï¸"}},"./ui/helpers/utils/gas.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{DW:()=>isMetamaskSuggestedGasEstimate,Ll:()=>gasEstimateGreaterThanGasUsedPlusTenPercent,VS:()=>editGasModeIsSpeedUpOrCancel,Vc:()=>addTenPercentAndRound,m5:()=>formatGasFeeOrFeeRange});var lodash__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/lodash.js"),bignumber_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/bignumber.js/bignumber.js"),bignumber_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(bignumber_js__WEBPACK_IMPORTED_MODULE_1__),_shared_constants_gas__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./shared/constants/gas.ts"),_shared_modules_conversion_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./shared/modules/conversion.utils.ts"),_shared_modules_Numeric__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./shared/modules/Numeric.ts"),_util__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ui/helpers/utils/util.js");const TEN_PERCENT_NUMERIC=new _shared_modules_Numeric__WEBPACK_IMPORTED_MODULE_4__.D(1.1,10),gasEstimateGreaterThanGasUsedPlusTenPercent=(gasUsed,gasFeeEstimates,estimate)=>{var _gasFeeEstimates$esti;let{maxFeePerGas:maxFeePerGasInTransaction}=gasUsed;maxFeePerGasInTransaction=new(bignumber_js__WEBPACK_IMPORTED_MODULE_1___default())((0,_shared_modules_conversion_utils__WEBPACK_IMPORTED_MODULE_3__.Yg)(addTenPercentAndRound(maxFeePerGasInTransaction)));const maxFeePerGasFromEstimate=null===(_gasFeeEstimates$esti=gasFeeEstimates[estimate])||void 0===_gasFeeEstimates$esti?void 0:_gasFeeEstimates$esti.suggestedMaxFeePerGas;return(0,_util__WEBPACK_IMPORTED_MODULE_5__.Xn)(maxFeePerGasFromEstimate,maxFeePerGasInTransaction)};function addTenPercentAndRound(hexStringValue){if(void 0!==hexStringValue)return new _shared_modules_Numeric__WEBPACK_IMPORTED_MODULE_4__.D(hexStringValue,16).times(TEN_PERCENT_NUMERIC).round(0).toPrefixedHexString()}function isMetamaskSuggestedGasEstimate(estimate){return[_shared_constants_gas__WEBPACK_IMPORTED_MODULE_2__.RQ.high,_shared_constants_gas__WEBPACK_IMPORTED_MODULE_2__.RQ.medium,_shared_constants_gas__WEBPACK_IMPORTED_MODULE_2__.RQ.low].includes(estimate)}function formatGasFeeOrFeeRange(feeOrFeeRange,{precision:precisionOrPrecisions=2}={}){if((0,_util__WEBPACK_IMPORTED_MODULE_5__.Rw)(feeOrFeeRange)||Array.isArray(feeOrFeeRange)&&0===feeOrFeeRange.length)return null;const range=Array.isArray(feeOrFeeRange)?feeOrFeeRange.slice(0,2):[feeOrFeeRange],precisions=Array.isArray(precisionOrPrecisions)?precisionOrPrecisions.slice(0,2):(0,lodash__WEBPACK_IMPORTED_MODULE_0__.times)(range.length,(0,lodash__WEBPACK_IMPORTED_MODULE_0__.constant)(precisionOrPrecisions));return`${(0,lodash__WEBPACK_IMPORTED_MODULE_0__.uniq)((0,lodash__WEBPACK_IMPORTED_MODULE_0__.zip)(range,precisions).map((([fee,precision])=>void 0===precision?fee:(0,_util__WEBPACK_IMPORTED_MODULE_5__.YQ)(fee,precision)))).join(" - ")} GWEI`}function editGasModeIsSpeedUpOrCancel(editGasMode){return editGasMode===_shared_constants_gas__WEBPACK_IMPORTED_MODULE_2__.G_.cancel||editGasMode===_shared_constants_gas__WEBPACK_IMPORTED_MODULE_2__.G_.speedUp}},"./ui/hooks/gasFeeInput/useGasFeeInputs.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{a:()=>useGasFeeInputs});var react=__webpack_require__("./node_modules/react/index.js"),es=__webpack_require__("./node_modules/react-redux/es/index.js"),gas=__webpack_require__("./shared/constants/gas.ts"),constants_gas=__webpack_require__("./ui/helpers/constants/gas.js"),selectors=__webpack_require__("./ui/selectors/index.js"),transactions_util=__webpack_require__("./ui/helpers/utils/transactions.util.js"),useGasFeeEstimates=__webpack_require__("./ui/hooks/useGasFeeEstimates.js"),utils_gas=__webpack_require__("./ui/helpers/utils/gas.js"),conversion_utils=__webpack_require__("./shared/modules/conversion.utils.ts"),Numeric=__webpack_require__("./shared/modules/Numeric.ts"),common=__webpack_require__("./shared/constants/common.ts"),util=__webpack_require__("./ui/helpers/utils/util.js");const validateGasLimit=(gasLimit,minimumGasLimit)=>{if(new Numeric.D(gasLimit,10).lessThan(new Numeric.D(minimumGasLimit||gas.Kw.SIMPLE,16)))return constants_gas.IT.GAS_LIMIT_OUT_OF_BOUNDS},validateMaxPriorityFee=(maxPriorityFeePerGas,supportsEIP1559)=>{if(supportsEIP1559)return(0,util.A7)(maxPriorityFeePerGas,0)?constants_gas.IT.MAX_PRIORITY_FEE_BELOW_MINIMUM:void 0},validateMaxFee=(maxFeePerGas,maxPriorityFeeError,maxPriorityFeePerGas,supportsEIP1559)=>{if(!maxPriorityFeeError&&supportsEIP1559)return(0,util.Xn)(maxPriorityFeePerGas,maxFeePerGas)?constants_gas.IT.MAX_FEE_IMBALANCE:void 0},validateGasPrice=(isFeeMarketGasEstimate,gasPrice,supportsEIP1559,transaction)=>{var _transaction$txParams;if(!supportsEIP1559||!isFeeMarketGasEstimate)return(!supportsEIP1559||null!=transaction&&null!==(_transaction$txParams=transaction.txParams)&&void 0!==_transaction$txParams&&_transaction$txParams.gasPrice)&&(0,util.A7)(gasPrice,0)?constants_gas.IT.GAS_PRICE_TOO_LOW:void 0},getMaxPriorityFeeWarning=(gasFeeEstimates,isFeeMarketGasEstimate,isGasEstimatesLoading,maxPriorityFeePerGas,supportsEIP1559)=>{var _gasFeeEstimates$low;if(supportsEIP1559&&isFeeMarketGasEstimate&&!isGasEstimatesLoading)return(0,util.A7)(maxPriorityFeePerGas,null==gasFeeEstimates||null===(_gasFeeEstimates$low=gasFeeEstimates.low)||void 0===_gasFeeEstimates$low?void 0:_gasFeeEstimates$low.suggestedMaxPriorityFeePerGas)?constants_gas.IT.MAX_PRIORITY_FEE_TOO_LOW:null!=gasFeeEstimates&&gasFeeEstimates.high&&(0,util.Xn)(maxPriorityFeePerGas,1.5*gasFeeEstimates.high.suggestedMaxPriorityFeePerGas)?constants_gas.IT.MAX_PRIORITY_FEE_HIGH_WARNING:void 0},getMaxFeeWarning=(gasFeeEstimates,isGasEstimatesLoading,isFeeMarketGasEstimate,maxFeeError,maxPriorityFeeError,maxFeePerGas,supportsEIP1559)=>{var _gasFeeEstimates$low2;if(!maxPriorityFeeError&&!maxFeeError&&isFeeMarketGasEstimate&&supportsEIP1559&&!isGasEstimatesLoading)return(0,util.A7)(maxFeePerGas,null==gasFeeEstimates||null===(_gasFeeEstimates$low2=gasFeeEstimates.low)||void 0===_gasFeeEstimates$low2?void 0:_gasFeeEstimates$low2.suggestedMaxFeePerGas)?constants_gas.IT.MAX_FEE_TOO_LOW:null!=gasFeeEstimates&&gasFeeEstimates.high&&(0,util.Xn)(maxFeePerGas,1.5*gasFeeEstimates.high.suggestedMaxFeePerGas)?constants_gas.IT.MAX_FEE_HIGH_WARNING:void 0},hasBalanceError=(minimumCostInHexWei,transaction,ethBalance)=>{var _transaction$txParams2;if(void 0===minimumCostInHexWei||void 0===ethBalance)return!1;const minimumTxCostInHexWei=new Numeric.D(minimumCostInHexWei,16).add(new Numeric.D((null==transaction||null===(_transaction$txParams2=transaction.txParams)||void 0===_transaction$txParams2?void 0:_transaction$txParams2.value)||"0x0",16)),ethBalanceInHexWei=new Numeric.D(ethBalance,16);return minimumTxCostInHexWei.greaterThan(ethBalanceInHexWei)};var lodash=__webpack_require__("./node_modules/lodash/lodash.js");function getGasFeeEstimate(field,gasFeeEstimates,gasEstimateType,estimateToUse,fallback="0"){var _gasFeeEstimates$esti;return gasEstimateType===gas.gB.feeMarket?(null==gasFeeEstimates||null===(_gasFeeEstimates$esti=gasFeeEstimates[estimateToUse])||void 0===_gasFeeEstimates$esti?void 0:_gasFeeEstimates$esti[field])??String(fallback):String(fallback)}const feeParamsAreCustom=transaction=>!(null!=transaction&&transaction.userFeeLevel)||(null==transaction?void 0:transaction.userFeeLevel)===gas.d_;function useGasPriceInput({estimateToUse,gasEstimateType,gasFeeEstimates,transaction}){const[gasPriceHasBeenManuallySet,setGasPriceHasBeenManuallySet]=(0,react.useState)((null==transaction?void 0:transaction.userFeeLevel)===gas.d_),[gasPrice,setGasPrice]=(0,react.useState)((()=>{const{gasPrice:txGasPrice}=(null==transaction?void 0:transaction.txParams)||{};return txGasPrice&&feeParamsAreCustom(transaction)?Number((0,conversion_utils.Yg)(txGasPrice)):null})),[initialGasPriceEstimates]=(0,react.useState)(gasFeeEstimates),gasPriceEstimatesHaveNotChanged=(0,lodash.isEqual)(initialGasPriceEstimates,gasFeeEstimates),gasPriceToUse=null!==gasPrice&&(gasPriceHasBeenManuallySet||gasPriceEstimatesHaveNotChanged||(0,transactions_util.h0)(null==transaction?void 0:transaction.txParams))?gasPrice:function getGasPriceEstimate(gasFeeEstimates,gasEstimateType,estimateToUse){return gasEstimateType===gas.gB.legacy?(null==gasFeeEstimates?void 0:gasFeeEstimates[estimateToUse])??"0":gasEstimateType===gas.gB.ethGasPrice?(null==gasFeeEstimates?void 0:gasFeeEstimates.gasPrice)??"0":"0"}(gasFeeEstimates,gasEstimateType,estimateToUse);return{gasPrice:gasPriceToUse,setGasPrice,setGasPriceHasBeenManuallySet}}const getMaxFeePerGasFromTransaction=(transaction,gasFeeEstimates)=>{if(null!=gasFeeEstimates&&gasFeeEstimates[null==transaction?void 0:transaction.userFeeLevel])return gasFeeEstimates[transaction.userFeeLevel].suggestedMaxFeePerGas;const{maxFeePerGas,gasPrice}=(null==transaction?void 0:transaction.txParams)||{};return Number((0,conversion_utils.Yg)(maxFeePerGas||gasPrice))};const isNullOrUndefined=value=>null==value,getMaxPriorityFeePerGasFromTransaction=(transaction,gasFeeEstimates)=>{if(null!=gasFeeEstimates&&gasFeeEstimates[null==transaction?void 0:transaction.userFeeLevel])return gasFeeEstimates[transaction.userFeeLevel].suggestedMaxPriorityFeePerGas;const{maxPriorityFeePerGas,maxFeePerGas,gasPrice}=(null==transaction?void 0:transaction.txParams)||{},feeInHexWei=maxPriorityFeePerGas||maxFeePerGas||gasPrice;return feeInHexWei?Number((0,conversion_utils.Yg)(feeInHexWei)):null};var gas_utils=__webpack_require__("./shared/modules/gas.utils.js"),constants_common=__webpack_require__("./ui/helpers/constants/common.ts"),useCurrencyDisplay=__webpack_require__("./ui/hooks/useCurrencyDisplay.js"),useUserPreferencedCurrency=__webpack_require__("./ui/hooks/useUserPreferencedCurrency.js");var bignumber=__webpack_require__("./node_modules/bignumber.js/bignumber.js"),bignumber_default=__webpack_require__.n(bignumber),actions=__webpack_require__("./ui/store/actions.ts");const useTransactionFunctions=({defaultEstimateToUse,editGasMode,estimatedBaseFee,gasFeeEstimates,gasLimit:gasLimitValue,maxPriorityFeePerGas:maxPriorityFeePerGasValue,transaction,setRetryTxMeta})=>{const dispatch=(0,es.I0)(),getTxMeta=(0,react.useCallback)((()=>{if(editGasMode!==gas.G_.cancel&&editGasMode!==gas.G_.speedUp||transaction.previousGas)return{};const{maxFeePerGas,maxPriorityFeePerGas,gasLimit}=(null==transaction?void 0:transaction.txParams)??{};return{previousGas:{maxFeePerGas,maxPriorityFeePerGas,gasLimit}}}),[editGasMode,null==transaction?void 0:transaction.previousGas,null==transaction?void 0:transaction.txParams]),updateTransaction=(0,react.useCallback)((async({estimateUsed,gasLimit,maxFeePerGas,maxPriorityFeePerGas,estimateSuggested})=>{const newGasSettings={gas:(0,conversion_utils.X0)(gasLimit||gasLimitValue),gasLimit:(0,conversion_utils.X0)(gasLimit||gasLimitValue),estimateSuggested:estimateSuggested||defaultEstimateToUse,estimateUsed};maxFeePerGas&&(newGasSettings.maxFeePerGas=maxFeePerGas),maxPriorityFeePerGas&&(newGasSettings.maxPriorityFeePerGas=maxPriorityFeePerGas||(0,conversion_utils.Kn)(maxPriorityFeePerGasValue));const txMeta=getTxMeta(),updatedTxMeta={...transaction,userFeeLevel:estimateUsed||gas.o7.custom,txParams:{...transaction.txParams,...newGasSettings},...txMeta};editGasMode===gas.G_.swaps?(dispatch((0,actions.buW)(estimateUsed||gas.o7.custom)),dispatch((0,actions.UEg)(newGasSettings))):(0,utils_gas.VS)(editGasMode)?setRetryTxMeta(updatedTxMeta):(newGasSettings.userEditedGasLimit=updatedTxMeta.userEditedGasLimit,newGasSettings.userFeeLevel=updatedTxMeta.userFeeLevel,txMeta&&txMeta.previousGas&&await dispatch((0,actions.BpP)(updatedTxMeta.id,txMeta.previousGas)),await dispatch((0,actions.ol_)(updatedTxMeta.id,newGasSettings)))}),[defaultEstimateToUse,dispatch,editGasMode,gasLimitValue,getTxMeta,maxPriorityFeePerGasValue,transaction,setRetryTxMeta]),cancelTransaction=(0,react.useCallback)((()=>{dispatch((0,actions.vGx)(transaction.id,transaction.txParams,{estimatedBaseFee}))}),[dispatch,estimatedBaseFee,transaction]),speedUpTransaction=(0,react.useCallback)((()=>{dispatch((0,actions.$eK)(transaction.id,transaction.txParams,{estimatedBaseFee}))}),[dispatch,estimatedBaseFee,transaction]),updateTransactionToTenPercentIncreasedGasFee=(0,react.useCallback)(((initTransaction=!1)=>{const{gas:gasLimit,maxFeePerGas,maxPriorityFeePerGas}=transaction.previousGas||transaction.txParams,newMaxPriorityFeePerGas=new(bignumber_default())(maxPriorityFeePerGas,16).isZero()?(0,conversion_utils.Kn)(gasFeeEstimates[defaultEstimateToUse].suggestedMaxPriorityFeePerGas):maxPriorityFeePerGas,estimateUsed="0x0"===maxPriorityFeePerGas?gas.d_:gas.o7.tenPercentIncreased;updateTransaction({estimateSuggested:initTransaction?defaultEstimateToUse:gas.o7.tenPercentIncreased,estimateUsed,gasLimit,maxFeePerGas:(0,utils_gas.Vc)(maxFeePerGas),maxPriorityFeePerGas:(0,utils_gas.Vc)(newMaxPriorityFeePerGas)})}),[defaultEstimateToUse,gasFeeEstimates,transaction,updateTransaction]),updateTransactionUsingEstimate=(0,react.useCallback)((gasFeeEstimateToUse=>{if(!gasFeeEstimates[gasFeeEstimateToUse])return;const{suggestedMaxFeePerGas,suggestedMaxPriorityFeePerGas}=gasFeeEstimates[gasFeeEstimateToUse];updateTransaction({estimateUsed:gasFeeEstimateToUse,maxFeePerGas:(0,conversion_utils.Kn)(suggestedMaxFeePerGas),maxPriorityFeePerGas:(0,conversion_utils.Kn)(suggestedMaxPriorityFeePerGas)})}),[gasFeeEstimates,updateTransaction]),updateTransactionUsingDAPPSuggestedValues=(0,react.useCallback)((()=>{const{maxFeePerGas,maxPriorityFeePerGas}=(null==transaction?void 0:transaction.dappSuggestedGasFees)??{};updateTransaction({estimateUsed:gas.o7.dAppSuggested,maxFeePerGas,maxPriorityFeePerGas})}),[transaction,updateTransaction]);return{cancelTransaction,speedUpTransaction,updateTransaction,updateTransactionToTenPercentIncreasedGasFee,updateTransactionUsingDAPPSuggestedValues,updateTransactionUsingEstimate}},GAS_LIMIT_TOO_HIGH_IN_ETH="1";function useGasFeeInputs(defaultEstimateToUse=gas.RQ.medium,_transaction,minimumGasLimit="0x5208",editGasMode=gas.G_.modifyInPlace){const initialRetryTxMeta={txParams:null==_transaction?void 0:_transaction.txParams,id:null==_transaction?void 0:_transaction.id,userFeeLevel:null==_transaction?void 0:_transaction.userFeeLevel,originalGasEstimate:null==_transaction?void 0:_transaction.originalGasEstimate,userEditedGasLimit:null==_transaction?void 0:_transaction.userEditedGasLimit};null!=_transaction&&_transaction.previousGas&&(initialRetryTxMeta.previousGas=null==_transaction?void 0:_transaction.previousGas);const[retryTxMeta,setRetryTxMeta]=(0,react.useState)(initialRetryTxMeta),transaction=(0,utils_gas.VS)(editGasMode)?retryTxMeta:_transaction,supportsEIP1559=(0,es.v9)(selectors.mVn)&&!(0,transactions_util.h0)(null==transaction?void 0:transaction.txParams),{gasEstimateType,gasFeeEstimates,isGasEstimatesLoading,isNetworkBusy}=(0,useGasFeeEstimates.a)(),userPrefersAdvancedGas=(0,es.v9)(selectors.uRW),[estimateToUse,setInternalEstimateToUse]=(0,react.useState)((()=>{var _transaction$txParams,_transaction$txParams2;return userPrefersAdvancedGas&&null!=transaction&&null!==(_transaction$txParams=transaction.txParams)&&void 0!==_transaction$txParams&&_transaction$txParams.maxPriorityFeePerGas&&null!=transaction&&null!==(_transaction$txParams2=transaction.txParams)&&void 0!==_transaction$txParams2&&_transaction$txParams2.maxFeePerGas?null:transaction?(null==transaction?void 0:transaction.userFeeLevel)||null:defaultEstimateToUse})),[estimateUsed,setEstimateUsed]=(0,react.useState)((()=>estimateToUse||gas.o7.custom)),[gasLimit,setGasLimit]=(0,react.useState)((()=>{var _transaction$txParams3;return Number((0,conversion_utils.Z8)((null==transaction||null===(_transaction$txParams3=transaction.txParams)||void 0===_transaction$txParams3?void 0:_transaction$txParams3.gas)??"0x0"))})),properGasLimit=Number((0,conversion_utils.Z8)(null==transaction?void 0:transaction.originalGasEstimate));(0,react.useEffect)((()=>{if(supportsEIP1559){var _transaction$txParams4,_transaction$txParams5,_transaction$txParams6;null!=transaction&&transaction.userFeeLevel&&setInternalEstimateToUse(null==transaction?void 0:transaction.userFeeLevel);const maximumGas=new Numeric.D((null==transaction||null===(_transaction$txParams4=transaction.txParams)||void 0===_transaction$txParams4?void 0:_transaction$txParams4.gas)??"0x0",16).times(new Numeric.D((null==transaction||null===(_transaction$txParams5=transaction.txParams)||void 0===_transaction$txParams5?void 0:_transaction$txParams5.maxFeePerGas)??"0x0",16)).toPrefixedHexString(),fee=new Numeric.D(maximumGas,16,common.E.WEI).toDenomination(common.E.ETH).toBase(10).toString();Number(fee)>Number(GAS_LIMIT_TOO_HIGH_IN_ETH)?setEstimateUsed(gas.o7.dappSuggestedHigh):null!=transaction&&transaction.userFeeLevel&&setEstimateUsed(null==transaction?void 0:transaction.userFeeLevel),setGasLimit(Number((0,conversion_utils.Z8)((null==transaction||null===(_transaction$txParams6=transaction.txParams)||void 0===_transaction$txParams6?void 0:_transaction$txParams6.gas)??"0x0")))}}),[setEstimateUsed,setGasLimit,setInternalEstimateToUse,supportsEIP1559,transaction]);const{gasPrice,setGasPrice,setGasPriceHasBeenManuallySet}=useGasPriceInput({estimateToUse,gasEstimateType,gasFeeEstimates,transaction}),{maxFeePerGas,setMaxFeePerGas}=function useMaxFeePerGasInput({estimateToUse,gasEstimateType,gasFeeEstimates,transaction}){const supportsEIP1559=(0,es.v9)(selectors.mVn)&&!(0,transactions_util.h0)(null==transaction?void 0:transaction.txParams),initialMaxFeePerGas=supportsEIP1559?getMaxFeePerGasFromTransaction(transaction,gasFeeEstimates):0,[maxFeePerGas,setMaxFeePerGas]=(0,react.useState)((()=>initialMaxFeePerGas&&feeParamsAreCustom(transaction)?initialMaxFeePerGas:null));return(0,react.useEffect)((()=>{supportsEIP1559&&initialMaxFeePerGas&&setMaxFeePerGas(initialMaxFeePerGas)}),[initialMaxFeePerGas,setMaxFeePerGas,supportsEIP1559]),{maxFeePerGas:maxFeePerGas??getGasFeeEstimate("suggestedMaxFeePerGas",gasFeeEstimates,gasEstimateType,estimateToUse,initialMaxFeePerGas||0),setMaxFeePerGas}}({estimateToUse,gasEstimateType,gasFeeEstimates,transaction}),{maxPriorityFeePerGas,setMaxPriorityFeePerGas}=function useMaxPriorityFeePerGasInput({estimateToUse,gasEstimateType,gasFeeEstimates,transaction}){const supportsEIP1559=(0,es.v9)(selectors.mVn)&&!(0,transactions_util.h0)(null==transaction?void 0:transaction.txParams),initialMaxPriorityFeePerGas=supportsEIP1559?getMaxPriorityFeePerGasFromTransaction(transaction,gasFeeEstimates):null,[maxPriorityFeePerGas,setMaxPriorityFeePerGas]=(0,react.useState)((()=>!isNullOrUndefined(initialMaxPriorityFeePerGas)&&feeParamsAreCustom(transaction)?initialMaxPriorityFeePerGas:null));return(0,react.useEffect)((()=>{supportsEIP1559&&!isNullOrUndefined(initialMaxPriorityFeePerGas)&&setMaxPriorityFeePerGas(initialMaxPriorityFeePerGas)}),[initialMaxPriorityFeePerGas,setMaxPriorityFeePerGas,supportsEIP1559]),{maxPriorityFeePerGas:maxPriorityFeePerGas??getGasFeeEstimate("suggestedMaxPriorityFeePerGas",gasFeeEstimates,gasEstimateType,estimateToUse,initialMaxPriorityFeePerGas||0),setMaxPriorityFeePerGas}}({estimateToUse,gasEstimateType,gasFeeEstimates,transaction}),{estimatedMinimumNative,maximumCostInHexWei,minimumCostInHexWei}=function useGasEstimates({editGasMode,gasEstimateType,gasFeeEstimates,gasLimit,gasPrice,maxFeePerGas,maxPriorityFeePerGas,minimumGasLimit,transaction}){const supportsEIP1559=(0,es.v9)(selectors.mVn)&&!(0,transactions_util.h0)(null==transaction?void 0:transaction.txParams),{currency:primaryCurrency,numberOfDecimals:primaryNumberOfDecimals}=(0,useUserPreferencedCurrency.I)(constants_common._8);let gasSettings={gasLimit:(0,conversion_utils.X0)(gasLimit)};gasSettings=supportsEIP1559?{...gasSettings,maxFeePerGas:(0,conversion_utils.Kn)(maxFeePerGas||gasPrice||"0"),maxPriorityFeePerGas:(0,conversion_utils.Kn)(maxPriorityFeePerGas||maxFeePerGas||gasPrice||"0"),baseFeePerGas:(0,conversion_utils.Kn)(gasFeeEstimates.estimatedBaseFee??"0")}:{...gasSettings,gasPrice:gasEstimateType===gas.gB.none?"0x0":(0,conversion_utils.Kn)(gasPrice)};const maximumCostInHexWei=(0,gas_utils.a)(gasSettings);editGasMode===gas.G_.swaps&&(gasSettings={...gasSettings,gasLimit:minimumGasLimit});const minimumCostInHexWei=(0,gas_utils.r)(gasSettings),[estimatedMinimumNative]=(0,useCurrencyDisplay._)(minimumCostInHexWei,{numberOfDecimals:primaryNumberOfDecimals,currency:primaryCurrency});return{estimatedMinimumNative,maximumCostInHexWei,minimumCostInHexWei}}({editGasMode,gasEstimateType,gasFeeEstimates,gasLimit,gasPrice,maxFeePerGas,maxPriorityFeePerGas,minimumGasLimit,transaction}),{balanceError,gasErrors,hasGasErrors,hasSimulationError}=function useGasFeeErrors({gasEstimateType,gasFeeEstimates,isGasEstimatesLoading,gasLimit,gasPrice,maxPriorityFeePerGas,maxFeePerGas,minimumCostInHexWei,minimumGasLimit,transaction}){const supportsEIP1559=(0,es.v9)(selectors.mVn)&&!(0,transactions_util.h0)(null==transaction?void 0:transaction.txParams),isFeeMarketGasEstimate=gasEstimateType===gas.gB.feeMarket,gasLimitError=validateGasLimit(gasLimit,minimumGasLimit),maxPriorityFeeError=validateMaxPriorityFee(maxPriorityFeePerGas,supportsEIP1559),maxFeeError=validateMaxFee(maxFeePerGas,maxPriorityFeeError,maxPriorityFeePerGas,supportsEIP1559),gasPriceError=validateGasPrice(isFeeMarketGasEstimate,gasPrice,supportsEIP1559,transaction),maxPriorityFeeWarning=getMaxPriorityFeeWarning(gasFeeEstimates,isFeeMarketGasEstimate,isGasEstimatesLoading,maxPriorityFeePerGas,supportsEIP1559),maxFeeWarning=getMaxFeeWarning(gasFeeEstimates,isGasEstimatesLoading,isFeeMarketGasEstimate,maxFeeError,maxPriorityFeeError,maxFeePerGas,supportsEIP1559),gasErrors=(0,react.useMemo)((()=>{const errors={};return gasLimitError&&(errors.gasLimit=gasLimitError),maxPriorityFeeError&&(errors.maxPriorityFee=maxPriorityFeeError),maxFeeError&&(errors.maxFee=maxFeeError),gasPriceError&&(errors.gasPrice=gasPriceError),errors}),[gasLimitError,maxPriorityFeeError,maxFeeError,gasPriceError]),gasWarnings=(0,react.useMemo)((()=>{const warnings={};return maxPriorityFeeWarning&&(warnings.maxPriorityFee=maxPriorityFeeWarning),maxFeeWarning&&(warnings.maxFee=maxFeeWarning),warnings}),[maxPriorityFeeWarning,maxFeeWarning]),hasGasErrors=Boolean(Object.keys(gasErrors).length),errorsAndWarnings=(0,react.useMemo)((()=>({...gasWarnings,...gasErrors})),[gasErrors,gasWarnings]),{balance:ethBalance}=(0,es.v9)(selectors.uWD,es.wU);return{gasErrors:errorsAndWarnings,hasGasErrors,balanceError:hasBalanceError(minimumCostInHexWei,transaction,ethBalance),hasSimulationError:Boolean(null==transaction?void 0:transaction.simulationFails)}}({gasEstimateType,gasFeeEstimates,isGasEstimatesLoading,gasLimit,gasPrice,maxPriorityFeePerGas,maxFeePerGas,minimumCostInHexWei,minimumGasLimit,transaction}),handleGasLimitOutOfBoundError=(0,react.useCallback)((()=>{if(gasErrors.gasLimit===constants_gas.IT.GAS_LIMIT_OUT_OF_BOUNDS){var _transaction$txParams7;const transactionGasLimitDec=(0,conversion_utils.Z8)(null==transaction||null===(_transaction$txParams7=transaction.txParams)||void 0===_transaction$txParams7?void 0:_transaction$txParams7.gas),minimumGasLimitDec=(0,conversion_utils.Z8)(minimumGasLimit);setGasLimit(transactionGasLimitDec>minimumGasLimitDec?transactionGasLimitDec:minimumGasLimitDec)}}),[minimumGasLimit,gasErrors.gasLimit,transaction]),{cancelTransaction,speedUpTransaction,updateTransaction,updateTransactionToTenPercentIncreasedGasFee,updateTransactionUsingDAPPSuggestedValues,updateTransactionUsingEstimate}=useTransactionFunctions({defaultEstimateToUse,editGasMode,gasFeeEstimates,gasLimit,maxPriorityFeePerGas,minimumGasLimit,transaction,setRetryTxMeta}),onManualChange=(0,react.useCallback)((()=>{setInternalEstimateToUse(gas.d_),handleGasLimitOutOfBoundError(),setGasPrice(gasPrice),setGasLimit(gasLimit),setMaxFeePerGas(maxFeePerGas),setMaxPriorityFeePerGas(maxPriorityFeePerGas),setGasPriceHasBeenManuallySet(!0),setEstimateUsed("custom")}),[setInternalEstimateToUse,handleGasLimitOutOfBoundError,setGasPrice,gasPrice,setGasLimit,gasLimit,setMaxFeePerGas,maxFeePerGas,setMaxPriorityFeePerGas,maxPriorityFeePerGas,setGasPriceHasBeenManuallySet]);return{transaction,maxFeePerGas,maxPriorityFeePerGas,gasPrice,setGasPrice,gasLimit,setGasLimit,properGasLimit,editGasMode,estimateToUse,estimatedMinimumNative,maximumCostInHexWei,minimumCostInHexWei,estimateUsed,gasFeeEstimates,isNetworkBusy,onManualChange,balanceError,gasErrors,hasGasErrors,hasSimulationError,minimumGasLimitDec:(0,conversion_utils.Z8)(minimumGasLimit),supportsEIP1559,cancelTransaction,speedUpTransaction,updateTransaction,updateTransactionToTenPercentIncreasedGasFee,updateTransactionUsingDAPPSuggestedValues,updateTransactionUsingEstimate}}},"./ui/hooks/useCurrencyDisplay.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{_:()=>useCurrencyDisplay});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),react_redux__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react-redux/es/index.js"),_helpers_utils_confirm_tx_util__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ui/helpers/utils/confirm-tx.util.ts"),_selectors__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ui/selectors/index.js"),_ducks_metamask_metamask__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ui/ducks/metamask/metamask.js"),_shared_modules_conversion_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./shared/modules/conversion.utils.ts"),_shared_constants_network__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./shared/constants/network.ts"),_shared_modules_Numeric__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./shared/modules/Numeric.ts"),_shared_constants_common__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./shared/constants/common.ts");function useCurrencyDisplay(inputValue,{displayValue,prefix,numberOfDecimals,denomination,currency,...opts}){const currentCurrency=(0,react_redux__WEBPACK_IMPORTED_MODULE_1__.v9)(_selectors__WEBPACK_IMPORTED_MODULE_3__.TV3),nativeCurrency=(0,react_redux__WEBPACK_IMPORTED_MODULE_1__.v9)(_ducks_metamask_metamask__WEBPACK_IMPORTED_MODULE_4__.JK),conversionRate=(0,react_redux__WEBPACK_IMPORTED_MODULE_1__.v9)(_ducks_metamask_metamask__WEBPACK_IMPORTED_MODULE_4__.PC),isUserPreferredCurrency=currency===currentCurrency,value=(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)((()=>displayValue||(currency===nativeCurrency||!isUserPreferredCurrency&&!nativeCurrency?new _shared_modules_Numeric__WEBPACK_IMPORTED_MODULE_7__.D(inputValue,16,_shared_constants_common__WEBPACK_IMPORTED_MODULE_8__.E.WEI).toDenomination(denomination||_shared_constants_common__WEBPACK_IMPORTED_MODULE_8__.E.ETH).round(numberOfDecimals||2).toBase(10).toString():isUserPreferredCurrency&&conversionRate?(0,_helpers_utils_confirm_tx_util__WEBPACK_IMPORTED_MODULE_2__.xG)((0,_shared_modules_conversion_utils__WEBPACK_IMPORTED_MODULE_5__.nu)({value:inputValue,fromCurrency:nativeCurrency,toCurrency:currency,conversionRate,numberOfDecimals:numberOfDecimals||2,toDenomination:denomination}),currency):null)),[inputValue,nativeCurrency,conversionRate,displayValue,numberOfDecimals,denomination,currency,isUserPreferredCurrency]);let suffix;if(!opts.hideLabel){const currencyTickerSymbol=Object.values(_shared_constants_network__WEBPACK_IMPORTED_MODULE_6__.VL).includes(currency)?currency:null==currency?void 0:currency.toUpperCase();suffix=opts.suffix||currencyTickerSymbol}return[`${prefix||""}${value}${suffix?` ${suffix}`:""}`,{prefix,value,suffix}]}},"./ui/hooks/useGasFeeEstimates.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{a:()=>useGasFeeEstimates});var isEqual=__webpack_require__("./node_modules/lodash/isEqual.js"),isEqual_default=__webpack_require__.n(isEqual),es=__webpack_require__("./node_modules/react-redux/es/index.js"),metamask=__webpack_require__("./ui/ducks/metamask/metamask.js"),react=__webpack_require__("./node_modules/react/index.js"),actions=__webpack_require__("./ui/store/actions.ts");function useGasFeeEstimates(){const gasEstimateType=(0,es.v9)(metamask.xP),gasFeeEstimates=(0,es.v9)(metamask.lq,isEqual_default()),isGasEstimatesLoading=(0,es.v9)(metamask.rc),isNetworkBusy=(0,es.v9)(metamask.tg);return function useSafeGasEstimatePolling(){(0,react.useEffect)((()=>{let pollToken,active=!0;const cleanup=()=>{active=!1,pollToken&&((0,actions.T_6)(pollToken),(0,actions.hUm)(pollToken))};return(0,actions.mhS)().then((newPollToken=>{active?(pollToken=newPollToken,(0,actions.lTb)(pollToken)):((0,actions.T_6)(newPollToken),(0,actions.hUm)(pollToken))})),window.addEventListener("beforeunload",cleanup),()=>{cleanup(),window.removeEventListener("beforeunload",cleanup)}}),[])}(),{gasFeeEstimates,gasEstimateType,isGasEstimatesLoading,isNetworkBusy}}},"./ui/hooks/useUserPreferencedCurrency.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{I:()=>useUserPreferencedCurrency});var react_redux__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react-redux/es/index.js"),_selectors__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ui/selectors/index.js"),_ducks_metamask_metamask__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ui/ducks/metamask/metamask.js"),_helpers_constants_common__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ui/helpers/constants/common.ts"),_shared_constants_common__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./shared/constants/common.ts");function useUserPreferencedCurrency(type,opts={}){const nativeCurrency=(0,react_redux__WEBPACK_IMPORTED_MODULE_0__.v9)(_ducks_metamask_metamask__WEBPACK_IMPORTED_MODULE_2__.JK),{useNativeCurrencyAsPrimaryCurrency}=(0,react_redux__WEBPACK_IMPORTED_MODULE_0__.v9)(_selectors__WEBPACK_IMPORTED_MODULE_1__.Izy,react_redux__WEBPACK_IMPORTED_MODULE_0__.wU),showFiat=(0,react_redux__WEBPACK_IMPORTED_MODULE_0__.v9)(_selectors__WEBPACK_IMPORTED_MODULE_1__.i8I)||opts.showFiatOverride,currentCurrency=(0,react_redux__WEBPACK_IMPORTED_MODULE_0__.v9)(_selectors__WEBPACK_IMPORTED_MODULE_1__.TV3);let currency,numberOfDecimals;return!showFiat||type===_helpers_constants_common__WEBPACK_IMPORTED_MODULE_3__._8&&useNativeCurrencyAsPrimaryCurrency||type===_helpers_constants_common__WEBPACK_IMPORTED_MODULE_3__.Vb&&!useNativeCurrencyAsPrimaryCurrency?(currency=nativeCurrency||_shared_constants_common__WEBPACK_IMPORTED_MODULE_4__.E.ETH,numberOfDecimals=opts.numberOfDecimals||opts.ethNumberOfDecimals||8):(type===_helpers_constants_common__WEBPACK_IMPORTED_MODULE_3__.Vb&&useNativeCurrencyAsPrimaryCurrency||type===_helpers_constants_common__WEBPACK_IMPORTED_MODULE_3__._8&&!useNativeCurrencyAsPrimaryCurrency)&&(currency=currentCurrency,numberOfDecimals=opts.numberOfDecimals||opts.fiatNumberOfDecimals||2),{currency,numberOfDecimals}}}}]);