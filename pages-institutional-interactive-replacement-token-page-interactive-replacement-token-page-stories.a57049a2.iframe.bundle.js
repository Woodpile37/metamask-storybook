"use strict";(globalThis.webpackChunkmetamask_crx=globalThis.webpackChunkmetamask_crx||[]).push([[5092],{"./ui/pages/institutional/interactive-replacement-token-page/interactive-replacement-token-page.stories.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DefaultStory:()=>DefaultStory,__namedExportsOrder:()=>__namedExportsOrder,default:()=>interactive_replacement_token_page_stories});var react=__webpack_require__("./node_modules/react/index.js"),es=__webpack_require__("./node_modules/react-redux/es/index.js"),dist=__webpack_require__("./node_modules/@storybook/addon-actions/dist/index.mjs"),store=__webpack_require__("./ui/store/store.ts"),test_data=__webpack_require__("./.storybook/test-data.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),hexstring_utils=__webpack_require__("./shared/modules/hexstring-utils.ts"),history_history=__webpack_require__("./ui/ducks/history/history.js"),selectors=__webpack_require__("./ui/selectors/index.js"),ui_button=__webpack_require__("./ui/components/ui/button/index.js"),custody_labels=__webpack_require__("./ui/components/institutional/custody-labels/custody-labels.js"),pulse_loader=__webpack_require__("./ui/components/ui/pulse-loader/index.js"),routes=__webpack_require__("./ui/helpers/constants/routes.ts"),swaps=__webpack_require__("./shared/constants/swaps.ts"),network=__webpack_require__("./shared/constants/network.ts"),util=__webpack_require__("./ui/helpers/utils/util.js"),tooltip=__webpack_require__("./ui/components/ui/tooltip/index.js"),useI18nContext=__webpack_require__("./ui/hooks/useI18nContext.js"),institution_background=__webpack_require__("./ui/store/institutional/institution-background.ts"),box=__webpack_require__("./ui/components/ui/box/index.js"),component_library=__webpack_require__("./ui/components/component-library/index.js"),design_system=__webpack_require__("./ui/helpers/constants/design-system.ts"),useCopyToClipboard=__webpack_require__("./ui/hooks/useCopyToClipboard.js");const getButtonLinkHref=({address})=>`${swaps.k3[network.vo.MAINNET]}address/${address}`;function InteractiveReplacementTokenPage({history}){const dispatch=(0,es.I0)(),isMountedRef=(0,react.useRef)(!1),mmiActions=(0,institution_background.I6)(),{address}=(0,es.v9)((state=>state.metamask.modal.props)),{selectedAddress,custodyAccountDetails,interactiveReplacementToken,mmiConfiguration}=(0,es.v9)((state=>state.metamask)),{custodianName}=custodyAccountDetails[(0,hexstring_utils.QG)(address||selectedAddress)]||{},{url}=interactiveReplacementToken||{},{custodians}=mmiConfiguration,custodian=custodians.find((item=>item.name===custodianName))||{},mostRecentOverviewPage=(0,es.v9)(history_history.H7),metaMaskAccounts=(0,es.v9)(selectors.Dh7),connectRequests=(0,es.v9)((state=>{var _state$metamask$insti;return null===(_state$metamask$insti=state.metamask.institutionalFeatures)||void 0===_state$metamask$insti?void 0:_state$metamask$insti.connectRequests})),[isLoading,setIsLoading]=(0,react.useState)(!1),[tokenAccounts,setTokenAccounts]=(0,react.useState)([]),[error,setError]=(0,react.useState)(!1),t=(0,useI18nContext.C)(),[copied,handleCopy]=(0,useCopyToClipboard.m)(),{removeAddTokenConnectRequest,setCustodianNewRefreshToken,getCustodianAccounts}=mmiActions,connectRequest=connectRequests?connectRequests[0]:void 0;if((0,react.useEffect)((()=>(isMountedRef.current=!0,()=>isMountedRef.current=!1)),[]),(0,react.useEffect)((()=>{(async()=>{if(connectRequest)try{const custodianAccounts=await dispatch(getCustodianAccounts(connectRequest.token,connectRequest.apiUrl,connectRequest.service,!1)),mappedAccounts=custodianAccounts.filter((account=>metaMaskAccounts[account.address.toLowerCase()])).map((account=>{var _metaMaskAccounts$acc;return{address:account.address,name:account.name,labels:account.labels,balance:(null===(_metaMaskAccounts$acc=metaMaskAccounts[account.address.toLowerCase()])||void 0===_metaMaskAccounts$acc?void 0:_metaMaskAccounts$acc.balance)||0}}));isMountedRef.current&&(setTokenAccounts(mappedAccounts),setIsLoading(!1))}catch(e){setError(!0),setIsLoading(!1)}else history.push(mostRecentOverviewPage)})()}),[]),!connectRequest)return history.push(mostRecentOverviewPage),null;const onRemoveAddTokenConnectRequest=({origin,apiUrl,token})=>{dispatch(removeAddTokenConnectRequest({origin,apiUrl,token}))},handleReject=()=>{onRemoveAddTokenConnectRequest(connectRequest),history.push(mostRecentOverviewPage)};return react.createElement(box.ZP,{className:"page-container","data-testid":"interactive-replacement-token"},react.createElement(box.ZP,{className:`page-container__header ${error&&"error"}`},react.createElement(box.ZP,{className:"page-container__title"},t("custodianReplaceRefreshTokenTitle")," ",error?t("failed").toLowerCase():""),!error&&react.createElement(box.ZP,{className:"page-container__subtitle"},t("custodianReplaceRefreshTokenSubtitle"))),react.createElement(box.ZP,{className:"page-container__content"},react.createElement(box.ZP,{display:design_system.bA.FLEX,marginRight:7,marginLeft:7,overflowWrap:design_system.kC.BREAK_WORD,color:design_system.d9.textAlternative,className:"interactive-replacement-token-page"},error?react.createElement(component_library.xv,{"data-testid":"connect-error-message"},t("custodianReplaceRefreshTokenChangedFailed",[custodian.displayName||"Custodian"])):null,react.createElement(box.ZP,{display:design_system.bA.FLEX,flexDirection:design_system.uM.COLUMN,width:design_system.D8.FULL,"data-testid":"interactive-replacement-token-page"},tokenAccounts.map(((account,idx)=>react.createElement(box.ZP,{display:design_system.bA.FLEX,className:"interactive-replacement-token-page__item",key:account.address},react.createElement(box.ZP,{display:design_system.bA.FLEX,flexDirection:design_system.uM.COLUMN,width:design_system.D8.FULL},react.createElement(component_library.__,{marginTop:3,marginRight:2,htmlFor:`address-${idx}`},react.createElement(component_library.xv,{as:"span","data-testid":"account-name"},account.name)),react.createElement(component_library.__,{marginTop:1,marginRight:2,htmlFor:`address-${idx}`},react.createElement(component_library.xv,{as:"span",display:design_system.bA.FLEX,className:"interactive-replacement-token-page__item__address"},react.createElement(component_library.ZP,{href:getButtonLinkHref(account),target:"_blank",rel:"noopener noreferrer"},(0,util.$Q)(account.address),react.createElement(component_library.JO,{name:component_library.uH.Export,size:component_library.Jh.Sm,color:design_system.EY.primaryDefault,marginLeft:1})),react.createElement(tooltip.Z,{position:"bottom",title:t(copied?"copiedExclamation":"copyToClipboard")},react.createElement("button",{className:"interactive-replacement-token-page__item-clipboard",onClick:()=>handleCopy(account.address)},react.createElement(component_library.JO,{name:component_library.uH.Copy,size:component_library.Jh.Xs,color:design_system.EY.iconMuted}))))),react.createElement(box.ZP,{display:design_system.bA.FLEX,justifyContent:design_system.E0.spaceBetween},account.labels&&react.createElement(custody_labels.Z,{labels:account.labels,index:idx.toString(),hideNetwork:!0}))))))))),react.createElement(box.ZP,{className:"page-container__footer"},isLoading?react.createElement("footer",null,react.createElement(pulse_loader.Z,null)):react.createElement("footer",null,react.createElement(ui_button.Z,{type:"default",large:!0,className:"page-container__footer-button",onClick:handleReject},t("reject")),react.createElement(ui_button.Z,{type:"primary",large:!0,className:"page-container__footer-button",onClick:async()=>{if(error)return __webpack_require__.g.platform.openTab({url}),void handleReject();setIsLoading(!0);try{await Promise.all(tokenAccounts.map((async account=>{await dispatch(setCustodianNewRefreshToken({address:account.address,newAuthDetails:{refreshToken:connectRequest.token,refreshTokenUrl:connectRequest.apiUrl}}))}))),dispatch((0,institution_background.Y0)({})),onRemoveAddTokenConnectRequest(connectRequest),history.push({pathname:routes.B8,state:{imgSrc:null==custodian?void 0:custodian.iconUrl,title:t("custodianReplaceRefreshTokenChangedTitle"),description:t("custodianReplaceRefreshTokenChangedSubtitle")}}),isMountedRef.current&&setIsLoading(!1)}catch(e){console.error(e)}}},error?custodian.displayName||"Custodian":t("approveButtonText")))))}InteractiveReplacementTokenPage.propTypes={history:prop_types_default().object},InteractiveReplacementTokenPage.__docgenInfo={description:"",methods:[],displayName:"InteractiveReplacementTokenPage",props:{history:{description:"",type:{name:"object"},required:!1}}};const interactive_replacement_token_page=InteractiveReplacementTokenPage;var _DefaultStory$paramet,_DefaultStory$paramet2,_DefaultStory$paramet3;const address="0xC011a73ee8576Fb46F5E1c5751cA3B9Fe0af2a6F",customData={...test_data.default,metamask:{...test_data.default.metamask,modal:{props:address},selectedAddress:address,interactiveReplacementToken:{url:"https://saturn-custody-ui.codefi.network/"},custodyAccountDetails:{[address]:{balance:"0x",custodianName:"Jupiter"}},mmiConfiguration:{custodians:[{production:!0,name:"Jupiter",type:"Jupiter",iconUrl:"iconUrl",displayName:"displayName"}]},institutionalFeatures:{complianceProjectId:"",connectRequests:[{labels:[{key:"service",value:"test"}],origin:"origin",token:"testToken",feature:"custodian",service:"Jupiter",apiUrl:"https://",environment:"Jupiter"}]}}},interactive_replacement_token_page_stories_store=(0,store.Z)(customData),interactive_replacement_token_page_stories={title:"Pages/Institutional/InteractiveReplacementTokenPage",decorators:[story=>react.createElement(es.zt,{store:interactive_replacement_token_page_stories_store},story())],component:interactive_replacement_token_page,args:{history:{push:(0,dist.aD)("history.push()")}}},DefaultStory=args=>react.createElement(interactive_replacement_token_page,args);DefaultStory.storyName="InteractiveReplacementTokenPage",DefaultStory.parameters={...DefaultStory.parameters,docs:{...null===(_DefaultStory$paramet=DefaultStory.parameters)||void 0===_DefaultStory$paramet?void 0:_DefaultStory$paramet.docs,source:{originalSource:"args => <InteractiveReplacementTokenPage {...args} />",...null===(_DefaultStory$paramet2=DefaultStory.parameters)||void 0===_DefaultStory$paramet2||null===(_DefaultStory$paramet3=_DefaultStory$paramet2.docs)||void 0===_DefaultStory$paramet3?void 0:_DefaultStory$paramet3.source}}};const __namedExportsOrder=["DefaultStory"];DefaultStory.__docgenInfo={description:"",methods:[],displayName:"DefaultStory"}},"./ui/components/institutional/custody-labels/custody-labels.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_3__),_component_library__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ui/components/component-library/index.js"),_helpers_constants_design_system__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ui/helpers/constants/design-system.ts");const CustodyLabels=props=>{const{labels,index,background,hideNetwork}=props,filteredLabels=hideNetwork?labels.filter((item=>"network_name"!==item.key)):labels;return react__WEBPACK_IMPORTED_MODULE_0__.createElement(_component_library__WEBPACK_IMPORTED_MODULE_1__.__,{display:["flex"],flexDirection:["row"],htmlFor:`address-${index||0}`},filteredLabels.map((item=>react__WEBPACK_IMPORTED_MODULE_0__.createElement(_component_library__WEBPACK_IMPORTED_MODULE_1__.xv,{key:item.key,textTransform:_helpers_constants_design_system__WEBPACK_IMPORTED_MODULE_2__._5.Uppercase,className:"custody-label",style:background?{background}:{},marginTop:1,marginRight:1,marginBottom:2,paddingTop:1,paddingBottom:1,paddingLeft:2,paddingRight:2,backgroundColor:_helpers_constants_design_system__WEBPACK_IMPORTED_MODULE_2__.lP.backgroundAlternative,color:_helpers_constants_design_system__WEBPACK_IMPORTED_MODULE_2__.d9.textMuted,fontWeight:_helpers_constants_design_system__WEBPACK_IMPORTED_MODULE_2__.U9.Normal,borderRadius:_helpers_constants_design_system__WEBPACK_IMPORTED_MODULE_2__.cM.SM,variant:_helpers_constants_design_system__WEBPACK_IMPORTED_MODULE_2__.TypographyVariant.H9},item.value))))};CustodyLabels.propTypes={labels:prop_types__WEBPACK_IMPORTED_MODULE_3___default().array,index:prop_types__WEBPACK_IMPORTED_MODULE_3___default().string,background:prop_types__WEBPACK_IMPORTED_MODULE_3___default().string,hideNetwork:prop_types__WEBPACK_IMPORTED_MODULE_3___default().bool},CustodyLabels.__docgenInfo={description:"",methods:[],displayName:"CustodyLabels",props:{labels:{description:"",type:{name:"array"},required:!1},index:{description:"",type:{name:"string"},required:!1},background:{description:"",type:{name:"string"},required:!1},hideNetwork:{description:"",type:{name:"bool"},required:!1}}};const __WEBPACK_DEFAULT_EXPORT__=CustodyLabels},"./ui/components/ui/pulse-loader/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>_pulse_loader__WEBPACK_IMPORTED_MODULE_0__.Z});var _pulse_loader__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ui/components/ui/pulse-loader/pulse-loader.js")},"./ui/components/ui/pulse-loader/pulse-loader.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>PulseLoader});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js");function PulseLoader(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"pulse-loader"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"pulse-loader__loading-dot-one"}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"pulse-loader__loading-dot-two"}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"pulse-loader__loading-dot-three"}))}PulseLoader.__docgenInfo={description:"",methods:[],displayName:"PulseLoader"}},"./ui/store/institutional/institution-background.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{I6:()=>mmiActionsFactory,Lx:()=>setTypedMessageInProgress,Y0:()=>showInteractiveReplacementTokenBanner});var loglevel__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/loglevel/lib/loglevel.js"),loglevel__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(loglevel__WEBPACK_IMPORTED_MODULE_0__),_actions__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ui/store/actions.ts"),_action_queue__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ui/store/action-queue/index.ts"),_shared_modules_error__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./shared/modules/error.ts");function showInteractiveReplacementTokenBanner({url,oldRefreshToken}){return async dispatch=>{try{await(0,_action_queue__WEBPACK_IMPORTED_MODULE_2__.lf)("showInteractiveReplacementTokenBanner",[url,oldRefreshToken])}catch(err){if(err)throw dispatch((0,_actions__WEBPACK_IMPORTED_MODULE_1__.eaQ)(err.message)),new Error(err.message)}}}function setTypedMessageInProgress(msgId){return async dispatch=>{dispatch((0,_actions__WEBPACK_IMPORTED_MODULE_1__.Nbs)());try{await(0,_action_queue__WEBPACK_IMPORTED_MODULE_2__.lf)("setTypedMessageInProgress",[msgId])}catch(error){loglevel__WEBPACK_IMPORTED_MODULE_0___default().error(error),dispatch((0,_actions__WEBPACK_IMPORTED_MODULE_1__.eaQ)(error.message))}finally{await(0,_actions__WEBPACK_IMPORTED_MODULE_1__.Skm)(dispatch),dispatch((0,_actions__WEBPACK_IMPORTED_MODULE_1__.awJ)())}}}function mmiActionsFactory(){function createAsyncAction(name,params,useForceUpdateMetamaskState,loadingText){return loglevel__WEBPACK_IMPORTED_MODULE_0___default().debug(`background.${name}`),async dispatch=>{let result;loadingText&&dispatch((0,_actions__WEBPACK_IMPORTED_MODULE_1__.Nbs)(loadingText));try{result=await(0,_action_queue__WEBPACK_IMPORTED_MODULE_2__.lf)(name,[...params])}catch(error){throw dispatch((0,_actions__WEBPACK_IMPORTED_MODULE_1__.eaQ)(error)),(0,_shared_modules_error__WEBPACK_IMPORTED_MODULE_3__.M)(error)?new Error(error.message):error}return loadingText&&dispatch((0,_actions__WEBPACK_IMPORTED_MODULE_1__.awJ)()),useForceUpdateMetamaskState&&await(0,_actions__WEBPACK_IMPORTED_MODULE_1__.Skm)(dispatch),result}}function createAction(name,payload){return new Promise(((resolve,reject)=>{(0,_action_queue__WEBPACK_IMPORTED_MODULE_2__.BW)(name,[payload],(error=>{error?reject(error):resolve()}))}))}return{connectCustodyAddresses:(custodianType,custodianName,newAccounts)=>createAsyncAction("connectCustodyAddresses",[custodianType,custodianName,newAccounts],_actions__WEBPACK_IMPORTED_MODULE_1__.Skm,"Looking for your custodian account..."),getCustodianAccounts:(token,apiUrl,custody,getNonImportedAccounts)=>createAsyncAction("getCustodianAccounts",[token,apiUrl,custody,getNonImportedAccounts],_actions__WEBPACK_IMPORTED_MODULE_1__.Skm,"Getting custodian accounts..."),getCustodianAccountsByAddress:(jwt,apiUrl,address,custody)=>createAsyncAction("getCustodianAccountsByAddress",[jwt,apiUrl,address,custody],_actions__WEBPACK_IMPORTED_MODULE_1__.Skm,"Getting custodian accounts..."),getCustodianTransactionDeepLink:(address,txId)=>createAsyncAction("getCustodianTransactionDeepLink",[address,txId],_actions__WEBPACK_IMPORTED_MODULE_1__.Skm),getCustodianConfirmDeepLink:txId=>createAsyncAction("getCustodianConfirmDeepLink",[txId],_actions__WEBPACK_IMPORTED_MODULE_1__.Skm),getCustodianSignMessageDeepLink:(from,custodyTxId)=>createAsyncAction("getCustodianSignMessageDeepLink",[from,custodyTxId],_actions__WEBPACK_IMPORTED_MODULE_1__.Skm),getCustodianToken:custody=>createAsyncAction("getCustodianToken",[custody],_actions__WEBPACK_IMPORTED_MODULE_1__.Skm),getCustodianJWTList:custody=>createAsyncAction("getCustodianJWTList",[custody],_actions__WEBPACK_IMPORTED_MODULE_1__.Skm),setWaitForConfirmDeepLinkDialog:waitForConfirmDeepLinkDialog=>createAction("setWaitForConfirmDeepLinkDialog",waitForConfirmDeepLinkDialog),setComplianceAuthData:(clientId,projectId)=>createAsyncAction("setComplianceAuthData",[{clientId,projectId}]),deleteComplianceAuthData:()=>createAsyncAction("deleteComplianceAuthData",[]),generateComplianceReport:address=>createAction("generateComplianceReport",address),getComplianceHistoricalReportsByAddress:(address,projectId)=>createAsyncAction("getComplianceHistoricalReportsByAddress",[address,projectId]),syncReportsInProgress:(address,historicalReports)=>createAction("syncReportsInProgress",{address,historicalReports}),removeConnectInstitutionalFeature:(origin,projectId)=>createAction("removeConnectInstitutionalFeature",{origin,projectId}),removeAddTokenConnectRequest:({origin,apiUrl,token})=>createAction("removeAddTokenConnectRequest",{origin,apiUrl,token}),setCustodianConnectRequest:({token,apiUrl,custodianType,custodianName})=>createAsyncAction("setCustodianConnectRequest",[{token,apiUrl,custodianType,custodianName}]),getCustodianConnectRequest:()=>createAsyncAction("getCustodianConnectRequest",[]),getMmiConfiguration:()=>createAsyncAction("getMmiConfiguration",[]),getAllCustodianAccountsWithToken:(custodyType,token)=>createAsyncAction("getAllCustodianAccountsWithToken",[custodyType,token]),setCustodianNewRefreshToken:(address,oldAuthDetails,oldApiUrl,newAuthDetails,newApiUrl)=>createAsyncAction("setCustodianNewRefreshToken",[address,oldAuthDetails,oldApiUrl,newAuthDetails,newApiUrl])}}}}]);