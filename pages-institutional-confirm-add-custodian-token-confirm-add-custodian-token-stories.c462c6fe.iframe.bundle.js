"use strict";(globalThis.webpackChunkmetamask_crx=globalThis.webpackChunkmetamask_crx||[]).push([[9268],{"./ui/pages/institutional/confirm-add-custodian-token/confirm-add-custodian-token.stories.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DefaultStory:()=>DefaultStory,__namedExportsOrder:()=>__namedExportsOrder,default:()=>confirm_add_custodian_token_stories});var react=__webpack_require__("./node_modules/react/index.js"),es=__webpack_require__("./node_modules/react-redux/es/index.js"),store=__webpack_require__("./ui/store/store.ts"),test_data=__webpack_require__("./.storybook/test-data.js"),react_router=__webpack_require__("./node_modules/react-router/esm/react-router.js"),pulse_loader=__webpack_require__("./ui/components/ui/pulse-loader/index.js"),routes=__webpack_require__("./ui/helpers/constants/routes.ts"),design_system=__webpack_require__("./ui/helpers/constants/design-system.ts"),network=__webpack_require__("./shared/constants/network.ts"),i18n=__webpack_require__("./ui/contexts/i18n.js"),metametrics=__webpack_require__("./ui/contexts/metametrics.js"),history_history=__webpack_require__("./ui/ducks/history/history.js"),actions=__webpack_require__("./ui/store/actions.ts"),institution_background=__webpack_require__("./ui/store/institutional/institution-background.ts"),component_library=__webpack_require__("./ui/components/component-library/index.js"),institutional=__webpack_require__("./ui/ducks/institutional/institutional.js");const ConfirmAddCustodianToken=()=>{const t=(0,react.useContext)(i18n.OO),dispatch=(0,es.I0)(),history=(0,react_router.k6)(),trackEvent=(0,react.useContext)(metametrics.Wd),mmiActions=(0,institution_background.I6)(),mostRecentOverviewPage=(0,es.v9)(history_history.H7),connectRequests=(0,es.v9)(institutional.Ap),isComplianceActivated=(0,es.v9)(institutional.Zh),[showMore,setShowMore]=(0,react.useState)(!1),[isLoading,setIsLoading]=(0,react.useState)(!1),[connectError,setConnectError]=(0,react.useState)(""),connectRequest=connectRequests?connectRequests[0]:void 0;if(!connectRequest)return history.push(mostRecentOverviewPage),null;trackEvent({category:"MMI",event:"Custodian onboarding",properties:{actions:"Custodian RPC request",custodian:connectRequest.custodian,apiUrl:connectRequest.apiUrl}});let custodianLabel="";return connectRequest.labels&&connectRequest.labels.some((label=>"service"===label.key))&&(custodianLabel=connectRequest.labels.find((label=>"service"===label.key)).value),react.createElement(component_library.xu,{className:"page-container"},react.createElement(component_library.xu,{className:"page-container__header"},react.createElement(component_library.xv,{className:"page-container__title"},t("custodianAccount")),react.createElement(component_library.xv,{className:"page-container__subtitle"},t("mmiAddToken",[connectRequest.origin]))),react.createElement(component_library.xu,{padding:4,className:"page-container__content"},custodianLabel&&react.createElement(react.Fragment,null,react.createElement(component_library.xv,{padding:4,color:design_system.d9.textDefault},t("custodian")),react.createElement(component_library.__,{marginRight:4,marginLeft:4,color:design_system.d9.textAlternative,className:"add_custodian_token_confirm__url"},custodianLabel)),react.createElement(component_library.xv,{padding:4,color:design_system.d9.textDefault},t("token")),react.createElement(component_library.xu,{marginRight:4,marginLeft:4,className:"add_custodian_token_confirm__token"},react.createElement(component_library.xu,{paddingTop:2,paddingBottom:2,display:design_system.sS.Flex,flexDirection:design_system.Qb.Row,alignItems:design_system.g1.center},react.createElement(component_library.xv,null,showMore&&null!=connectRequest&&connectRequest.token?null==connectRequest?void 0:connectRequest.token:`...${null==connectRequest?void 0:connectRequest.token.slice(-9)}`),!showMore&&react.createElement(component_library.xu,{paddingLeft:2},react.createElement(component_library.ZP,{rel:"noopener noreferrer",onClick:()=>{setShowMore(!0)}},t("showMore"))))),connectRequest.apiUrl&&react.createElement(component_library.xu,null,react.createElement(component_library.xv,{padding:4,color:design_system.d9.textDefault},t("apiUrl")),react.createElement(component_library.xv,{marginRight:4,marginLeft:4,color:design_system.d9.textAlternative,fontSize:"14",className:"add_custodian_token_confirm__url"},connectRequest.apiUrl))),!isComplianceActivated&&react.createElement(component_library.xu,{marginTop:4,"data-testid":"connect-custodian-token-error"},react.createElement(component_library.xv,{"data-testid":"error-message",textAlign:design_system.PH.Center},connectError)),react.createElement(component_library.xu,{as:"footer",className:"page-container__footer",padding:4},isLoading?react.createElement(pulse_loader.Z,null):react.createElement(component_library.xu,{display:design_system.sS.Flex,gap:4},react.createElement(component_library.zx,{block:!0,variant:component_library.RN.SECONDARY,size:component_library.Gt.LG,"data-testid":"cancel-btn",onClick:async()=>{await mmiActions.removeAddTokenConnectRequest({origin:connectRequest.origin,apiUrl:connectRequest.apiUrl,token:connectRequest.token}),trackEvent({category:"MMI",event:"Custodian onboarding",properties:{actions:"Custodian RPC cancel",custodian:connectRequest.custodian,apiUrl:connectRequest.apiUrl}})}},t("cancel")),react.createElement(component_library.zx,{block:!0,"data-testid":"confirm-btn",size:component_library.Gt.LG,onClick:async()=>{setConnectError(""),setIsLoading(!0);try{if(connectRequest.chainId){const networkType=Object.keys(network.Jl).find((key=>Number(network.Jl[key].chainId).toString(10)===connectRequest.chainId.toString()));await dispatch((0,actions.wvr)(networkType))}let custodianName=connectRequest.service.toLowerCase();"JSONRPC"===connectRequest.service&&(custodianName=connectRequest.environment),await dispatch(mmiActions.setCustodianConnectRequest({token:connectRequest.token,apiUrl:connectRequest.apiUrl,custodianName,custodianType:connectRequest.service})),await mmiActions.removeAddTokenConnectRequest({origin:connectRequest.origin,apiUrl:connectRequest.apiUrl,token:connectRequest.token}),trackEvent({category:"MMI",event:"Custodian onboarding",properties:{actions:"Custodian RPC confirm",custodian:connectRequest.custodian,apiUrl:connectRequest.apiUrl}}),history.push(routes.Lc)}catch(e){let errorMessage=e.message;errorMessage||(errorMessage="Connection error"),setConnectError(errorMessage),setIsLoading(!1)}}},t("confirm")))))};ConfirmAddCustodianToken.__docgenInfo={description:"",methods:[],displayName:"ConfirmAddCustodianToken"};const confirm_add_custodian_token=ConfirmAddCustodianToken;var _DefaultStory$paramet,_DefaultStory$paramet2,_DefaultStory$paramet3;const customData={...test_data.default,metamask:{...test_data.default.metamask,institutionalFeatures:{complianceProjectId:"",connectRequests:[{labels:[{key:"service",value:"test"}],origin:"origin",token:"awesomeTestToken",feature:"custodian",service:"Saturn",apiUrl:"https://www.apiurl.net/v1",chainId:1}]}}},confirm_add_custodian_token_stories_store=(0,store.Z)(customData),confirm_add_custodian_token_stories={title:"Pages/Institutional/ConfirmAddCustodianToken",decorators:[story=>react.createElement(es.zt,{store:confirm_add_custodian_token_stories_store},story())],component:confirm_add_custodian_token},DefaultStory=()=>react.createElement(confirm_add_custodian_token,null);DefaultStory.storyName="ConfirmAddCustodianToken",DefaultStory.parameters={...DefaultStory.parameters,docs:{...null===(_DefaultStory$paramet=DefaultStory.parameters)||void 0===_DefaultStory$paramet?void 0:_DefaultStory$paramet.docs,source:{originalSource:"() => <ConfirmAddCustodianToken />",...null===(_DefaultStory$paramet2=DefaultStory.parameters)||void 0===_DefaultStory$paramet2||null===(_DefaultStory$paramet3=_DefaultStory$paramet2.docs)||void 0===_DefaultStory$paramet3?void 0:_DefaultStory$paramet3.source}}};const __namedExportsOrder=["DefaultStory"];DefaultStory.__docgenInfo={description:"",methods:[],displayName:"DefaultStory"}},"./ui/components/ui/pulse-loader/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>_pulse_loader__WEBPACK_IMPORTED_MODULE_0__.Z});var _pulse_loader__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ui/components/ui/pulse-loader/pulse-loader.js")},"./ui/components/ui/pulse-loader/pulse-loader.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>PulseLoader});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js");function PulseLoader(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"pulse-loader"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"pulse-loader__loading-dot-one"}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"pulse-loader__loading-dot-two"}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"pulse-loader__loading-dot-three"}))}PulseLoader.__docgenInfo={description:"",methods:[],displayName:"PulseLoader"}},"./ui/ducks/institutional/institutional.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ap:()=>getInstitutionalConnectRequests,Mp:()=>getComplianceHistoricalReportsByAddress,Zh:()=>complianceActivated,af:()=>getComplianceTenantSubdomain,ji:()=>fetchHistoricalReports});var reselect__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/reselect/lib/index.js"),_reduxjs_toolkit__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@reduxjs/toolkit/dist/redux-toolkit.cjs.development.js"),_sentry_browser__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@sentry/core/esm/exports.js"),_store_institutional_institution_background__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ui/store/institutional/institution-background.ts");const name="institutionalFeatures",slice=(0,_reduxjs_toolkit__WEBPACK_IMPORTED_MODULE_2__.createSlice)({name,initialState:{historicalReports:{},complianceProjectId:"",complianceClientId:"",reportsInProgress:{}},reducers:{setHistoricalReports(state,action){state.historicalReports[action.payload.address]=[...action.payload.reports]}}}),{actions,reducer}=slice;const getComplianceTenantSubdomain=state=>{var _state$metamask$name3;return null===(_state$metamask$name3=state.metamask[name])||void 0===_state$metamask$name3?void 0:_state$metamask$name3.complianceTenantSubdomain},getComplianceHistoricalReports=state=>{var _state$metamask$name4;return null===(_state$metamask$name4=state.metamask[name])||void 0===_state$metamask$name4?void 0:_state$metamask$name4.historicalReports},getInstitutionalConnectRequests=state=>{var _state$metamask$name6;return null===(_state$metamask$name6=state.metamask[name])||void 0===_state$metamask$name6?void 0:_state$metamask$name6.connectRequests},complianceActivated=state=>{var _state$metamask$name7;return Boolean(null===(_state$metamask$name7=state.metamask[name])||void 0===_state$metamask$name7?void 0:_state$metamask$name7.complianceProjectId)},getComplianceHistoricalReportsByAddress=address=>(0,reselect__WEBPACK_IMPORTED_MODULE_0__.P1)(getComplianceHistoricalReports,(reports=>reports?reports[address]:[])),fetchHistoricalReports=(address,testProjectId=void 0)=>async(dispatch,getState)=>{const state=getState(),mmiActions=(0,_store_institutional_institution_background__WEBPACK_IMPORTED_MODULE_1__.I6)();let projectId;if(testProjectId||(projectId=(state=>{var _state$metamask$name;return null===(_state$metamask$name=state.metamask[name])||void 0===_state$metamask$name?void 0:_state$metamask$name.complianceProjectId})(state),projectId))try{const result=await dispatch(mmiActions.getComplianceHistoricalReportsByAddress(address,projectId));dispatch(mmiActions.syncReportsInProgress({address,historicalReports:result.items?result.items:[]})),dispatch(actions.setHistoricalReports({address,reports:result.items?result.items.filter((report=>"inProgress"!==report.status)):[]}))}catch(error){console.error(error),(0,_sentry_browser__WEBPACK_IMPORTED_MODULE_3__.Tb)(error)}};const{setHistoricalReports}=actions},"./ui/store/institutional/institution-background.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{I6:()=>mmiActionsFactory,Lx:()=>setTypedMessageInProgress,Y0:()=>showInteractiveReplacementTokenBanner});var loglevel__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/loglevel/lib/loglevel.js"),loglevel__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(loglevel__WEBPACK_IMPORTED_MODULE_0__),_actions__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ui/store/actions.ts"),_action_queue__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ui/store/action-queue/index.ts"),_shared_modules_error__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./shared/modules/error.ts");function showInteractiveReplacementTokenBanner({url,oldRefreshToken}){return async dispatch=>{try{await(0,_action_queue__WEBPACK_IMPORTED_MODULE_2__.lf)("showInteractiveReplacementTokenBanner",[url,oldRefreshToken])}catch(err){if(err)throw dispatch((0,_actions__WEBPACK_IMPORTED_MODULE_1__.eaQ)(err.message)),new Error(err.message)}}}function setTypedMessageInProgress(msgId){return async dispatch=>{dispatch((0,_actions__WEBPACK_IMPORTED_MODULE_1__.Nbs)());try{await(0,_action_queue__WEBPACK_IMPORTED_MODULE_2__.lf)("setTypedMessageInProgress",[msgId])}catch(error){loglevel__WEBPACK_IMPORTED_MODULE_0___default().error(error),dispatch((0,_actions__WEBPACK_IMPORTED_MODULE_1__.eaQ)(error.message))}finally{await(0,_actions__WEBPACK_IMPORTED_MODULE_1__.Skm)(dispatch),dispatch((0,_actions__WEBPACK_IMPORTED_MODULE_1__.awJ)())}}}function mmiActionsFactory(){function createAsyncAction(name,params,useForceUpdateMetamaskState,loadingText){return loglevel__WEBPACK_IMPORTED_MODULE_0___default().debug(`background.${name}`),async dispatch=>{let result;loadingText&&dispatch((0,_actions__WEBPACK_IMPORTED_MODULE_1__.Nbs)(loadingText));try{result=await(0,_action_queue__WEBPACK_IMPORTED_MODULE_2__.lf)(name,[...params])}catch(error){throw dispatch((0,_actions__WEBPACK_IMPORTED_MODULE_1__.eaQ)(error)),(0,_shared_modules_error__WEBPACK_IMPORTED_MODULE_3__.M)(error)?new Error(error.message):error}return loadingText&&dispatch((0,_actions__WEBPACK_IMPORTED_MODULE_1__.awJ)()),useForceUpdateMetamaskState&&await(0,_actions__WEBPACK_IMPORTED_MODULE_1__.Skm)(dispatch),result}}function createAction(name,payload){return new Promise(((resolve,reject)=>{(0,_action_queue__WEBPACK_IMPORTED_MODULE_2__.BW)(name,[payload],(error=>{error?reject(error):resolve()}))}))}return{connectCustodyAddresses:(custodianType,custodianName,newAccounts)=>createAsyncAction("connectCustodyAddresses",[custodianType,custodianName,newAccounts],_actions__WEBPACK_IMPORTED_MODULE_1__.Skm,"Looking for your custodian account..."),getCustodianAccounts:(token,apiUrl,custody,getNonImportedAccounts)=>createAsyncAction("getCustodianAccounts",[token,apiUrl,custody,getNonImportedAccounts],_actions__WEBPACK_IMPORTED_MODULE_1__.Skm,"Getting custodian accounts..."),getCustodianAccountsByAddress:(jwt,apiUrl,address,custody)=>createAsyncAction("getCustodianAccountsByAddress",[jwt,apiUrl,address,custody],_actions__WEBPACK_IMPORTED_MODULE_1__.Skm,"Getting custodian accounts..."),getCustodianTransactionDeepLink:(address,txId)=>createAsyncAction("getCustodianTransactionDeepLink",[address,txId],_actions__WEBPACK_IMPORTED_MODULE_1__.Skm),getCustodianConfirmDeepLink:txId=>createAsyncAction("getCustodianConfirmDeepLink",[txId],_actions__WEBPACK_IMPORTED_MODULE_1__.Skm),getCustodianSignMessageDeepLink:(from,custodyTxId)=>createAsyncAction("getCustodianSignMessageDeepLink",[from,custodyTxId],_actions__WEBPACK_IMPORTED_MODULE_1__.Skm),getCustodianToken:custody=>createAsyncAction("getCustodianToken",[custody],_actions__WEBPACK_IMPORTED_MODULE_1__.Skm),getCustodianJWTList:custody=>createAsyncAction("getCustodianJWTList",[custody],_actions__WEBPACK_IMPORTED_MODULE_1__.Skm),setWaitForConfirmDeepLinkDialog:waitForConfirmDeepLinkDialog=>createAction("setWaitForConfirmDeepLinkDialog",waitForConfirmDeepLinkDialog),setComplianceAuthData:(clientId,projectId)=>createAsyncAction("setComplianceAuthData",[{clientId,projectId}]),deleteComplianceAuthData:()=>createAsyncAction("deleteComplianceAuthData",[]),generateComplianceReport:address=>createAction("generateComplianceReport",address),getComplianceHistoricalReportsByAddress:(address,projectId)=>createAsyncAction("getComplianceHistoricalReportsByAddress",[address,projectId]),syncReportsInProgress:(address,historicalReports)=>createAction("syncReportsInProgress",{address,historicalReports}),removeConnectInstitutionalFeature:(origin,projectId)=>createAction("removeConnectInstitutionalFeature",{origin,projectId}),removeAddTokenConnectRequest:({origin,apiUrl,token})=>createAction("removeAddTokenConnectRequest",{origin,apiUrl,token}),setCustodianConnectRequest:({token,apiUrl,custodianType,custodianName})=>createAsyncAction("setCustodianConnectRequest",[{token,apiUrl,custodianType,custodianName}]),getCustodianConnectRequest:()=>createAsyncAction("getCustodianConnectRequest",[]),getMmiConfiguration:()=>createAsyncAction("getMmiConfiguration",[]),getAllCustodianAccountsWithToken:(custodyType,token)=>createAsyncAction("getAllCustodianAccountsWithToken",[custodyType,token]),setCustodianNewRefreshToken:(address,oldAuthDetails,oldApiUrl,newAuthDetails,newApiUrl)=>createAsyncAction("setCustodianNewRefreshToken",[address,oldAuthDetails,oldApiUrl,newAuthDetails,newApiUrl])}}}}]);