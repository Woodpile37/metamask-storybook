"use strict";(globalThis.webpackChunkmetamask_crx=globalThis.webpackChunkmetamask_crx||[]).push([[8130],{"./ui/pages/connected-sites/connected-sites.stories.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DefaultStory:()=>DefaultStory,__namedExportsOrder:()=>__namedExportsOrder,default:()=>connected_sites_stories});var react=__webpack_require__("./node_modules/react/index.js"),es=__webpack_require__("./node_modules/react-redux/es/index.js"),actions=__webpack_require__("./ui/store/actions.ts"),selectors=__webpack_require__("./ui/selectors/index.js"),routes=__webpack_require__("./ui/helpers/constants/routes.ts"),history_history=__webpack_require__("./ui/ducks/history/history.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),ui_button=__webpack_require__("./ui/components/ui/button/index.js"),component_library=__webpack_require__("./ui/components/component-library/index.ts"),util=__webpack_require__("./ui/helpers/utils/util.js"),site_origin=__webpack_require__("./ui/components/ui/site-origin/index.js"),design_system=__webpack_require__("./ui/helpers/constants/design-system.ts");function _defineProperty(obj,key,value){return(key=function _toPropertyKey(arg){var key=function _toPrimitive(input,hint){if("object"!=typeof input||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0!==prim){var res=prim.call(input,hint||"default");if("object"!=typeof res)return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===hint?String:Number)(input)}(arg,"string");return"symbol"==typeof key?key:String(key)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class ConnectedSitesList extends react.Component{render(){const{connectedSubjects,onDisconnect}=this.props,{t}=this.context;return react.createElement("main",{className:"connected-sites-list__content-rows"},connectedSubjects.map((subject=>react.createElement("div",{key:subject.origin,className:"connected-sites-list__content-row"},react.createElement("div",{className:"connected-sites-list__subject-info"},react.createElement(component_library.zC,{className:"connected-sites-list__subject-icon",name:subject.name,size:design_system.$u.MD,src:subject.iconUrl}),react.createElement(site_origin.Z,{className:"connected-sites-list__subject-name",title:subject.extensionId||subject.origin,siteOrigin:this.getSubjectDisplayName(subject)})),react.createElement(ui_button.Z,{className:"connected-sites-list__content-row-link-button",onClick:()=>onDisconnect(subject.origin),type:"link"},t("disconnect"))))))}getSubjectDisplayName(subject){return subject.extensionId?this.context.t("externalExtension"):(0,util.j7)(subject.origin)}}_defineProperty(ConnectedSitesList,"contextTypes",{t:prop_types_default().func}),_defineProperty(ConnectedSitesList,"propTypes",{connectedSubjects:prop_types_default().arrayOf(prop_types_default().shape({name:prop_types_default().string,iconUrl:prop_types_default().string,origin:prop_types_default().string})).isRequired,onDisconnect:prop_types_default().func.isRequired}),ConnectedSitesList.__docgenInfo={description:"",methods:[{name:"getSubjectDisplayName",docblock:null,modifiers:[],params:[{name:"subject",type:null}],returns:null}],displayName:"ConnectedSitesList",props:{connectedSubjects:{description:"",type:{name:"arrayOf",value:{name:"shape",value:{name:{name:"string",required:!1},iconUrl:{name:"string",required:!1},origin:{name:"string",required:!1}}}},required:!0},onDisconnect:{description:"",type:{name:"func"},required:!0}},context:{t:{type:{name:"func"},required:!1}}};var popover_component=__webpack_require__("./ui/components/ui/popover/popover.component.js");function connected_sites_component_defineProperty(obj,key,value){return(key=function connected_sites_component_toPropertyKey(arg){var key=function connected_sites_component_toPrimitive(input,hint){if("object"!=typeof input||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0!==prim){var res=prim.call(input,hint||"default");if("object"!=typeof res)return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===hint?String:Number)(input)}(arg,"string");return"symbol"==typeof key?key:String(key)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class ConnectedSites extends react.Component{constructor(...args){super(...args),connected_sites_component_defineProperty(this,"state",{sitePendingDisconnect:null}),connected_sites_component_defineProperty(this,"setPendingDisconnect",(subjectKey=>{this.setState({sitePendingDisconnect:{subjectKey}})})),connected_sites_component_defineProperty(this,"clearPendingDisconnect",(()=>{this.setState({sitePendingDisconnect:null})})),connected_sites_component_defineProperty(this,"disconnectAccount",(()=>{const{disconnectAccount}=this.props,{sitePendingDisconnect}=this.state;disconnectAccount(sitePendingDisconnect.subjectKey),this.clearPendingDisconnect()})),connected_sites_component_defineProperty(this,"disconnectAllAccounts",(()=>{const{disconnectAllAccounts}=this.props,{sitePendingDisconnect}=this.state;disconnectAllAccounts(sitePendingDisconnect.subjectKey),this.clearPendingDisconnect()}))}componentDidMount(){const{getOpenMetamaskTabsIds}=this.props;getOpenMetamaskTabsIds()}renderConnectedSitesList(){return react.createElement(ConnectedSitesList,{connectedSubjects:this.props.connectedSubjects,onDisconnect:this.setPendingDisconnect})}renderConnectedSitesPopover(){const{accountLabel,closePopover,connectedSubjects,tabToConnect,requestAccountsPermission}=this.props,{t}=this.context;return react.createElement(popover_component.Z,{className:"connected-sites",title:t("connectedSites"),subtitle:connectedSubjects.length?t("connectedSitesDescription",[accountLabel]):t("connectedSitesEmptyDescription",[accountLabel]),onClose:closePopover,footer:tabToConnect?react.createElement("a",{className:"connected-sites__text-button",onClick:requestAccountsPermission},t("connectManually")):null,footerClassName:"connected-sites__add-site-manually"},this.renderConnectedSitesList())}renderDisconnectPopover(){const{closePopover,permittedAccountsByOrigin}=this.props,{t}=this.context,{sitePendingDisconnect:{subjectKey}}=this.state,numPermittedAccounts=permittedAccountsByOrigin[subjectKey].length;return react.createElement(popover_component.Z,{className:"connected-sites",title:t("disconnectPrompt",[subjectKey]),subtitle:t("disconnectAllAccountsConfirmationDescription"),onClose:closePopover,footer:react.createElement(react.Fragment,null,react.createElement("div",{className:"connected-sites__footer-row"},react.createElement(ui_button.Z,{type:"secondary",onClick:this.clearPendingDisconnect},t("cancel")),react.createElement(ui_button.Z,{type:"primary",onClick:this.disconnectAccount},t("disconnect"))),numPermittedAccounts>1?react.createElement("div",{className:"connected-sites__footer-row"},react.createElement("a",{className:"connected-sites__text-button",onClick:this.disconnectAllAccounts},t("disconnectAllAccounts"))):null),footerClassName:"connected-sites__confirmation"})}render(){const{sitePendingDisconnect}=this.state;return sitePendingDisconnect?this.renderDisconnectPopover():this.renderConnectedSitesPopover()}}connected_sites_component_defineProperty(ConnectedSites,"contextTypes",{t:prop_types_default().func}),connected_sites_component_defineProperty(ConnectedSites,"defaultProps",{tabToConnect:null}),connected_sites_component_defineProperty(ConnectedSites,"propTypes",{accountLabel:prop_types_default().string.isRequired,closePopover:prop_types_default().func.isRequired,connectedSubjects:prop_types_default().arrayOf(prop_types_default().object).isRequired,disconnectAllAccounts:prop_types_default().func.isRequired,disconnectAccount:prop_types_default().func.isRequired,getOpenMetamaskTabsIds:prop_types_default().func.isRequired,permittedAccountsByOrigin:prop_types_default().objectOf(prop_types_default().arrayOf(prop_types_default().string)).isRequired,tabToConnect:prop_types_default().object,requestAccountsPermission:prop_types_default().func.isRequired}),ConnectedSites.__docgenInfo={description:"",methods:[{name:"setPendingDisconnect",docblock:null,modifiers:[],params:[{name:"subjectKey",type:null}],returns:null},{name:"clearPendingDisconnect",docblock:null,modifiers:[],params:[],returns:null},{name:"disconnectAccount",docblock:null,modifiers:[],params:[],returns:null},{name:"disconnectAllAccounts",docblock:null,modifiers:[],params:[],returns:null},{name:"renderConnectedSitesList",docblock:null,modifiers:[],params:[],returns:null},{name:"renderConnectedSitesPopover",docblock:null,modifiers:[],params:[],returns:null},{name:"renderDisconnectPopover",docblock:null,modifiers:[],params:[],returns:null}],displayName:"ConnectedSites",props:{tabToConnect:{defaultValue:{value:"null",computed:!1},description:"",type:{name:"object"},required:!1},accountLabel:{description:"",type:{name:"string"},required:!0},closePopover:{description:"",type:{name:"func"},required:!0},connectedSubjects:{description:"",type:{name:"arrayOf",value:{name:"object"}},required:!0},disconnectAllAccounts:{description:"",type:{name:"func"},required:!0},disconnectAccount:{description:"",type:{name:"func"},required:!0},getOpenMetamaskTabsIds:{description:"",type:{name:"func"},required:!0},permittedAccountsByOrigin:{description:"",type:{name:"objectOf",value:{name:"arrayOf",value:{name:"string"}}},required:!0},requestAccountsPermission:{description:"",type:{name:"func"},required:!0}},context:{t:{type:{name:"func"},required:!1}}};const connected_sites_container=(0,es.$j)((state=>{var _permittedAccountsByO;const{openMetaMaskTabs}=state.appState,{id}=state.activeTab,connectedSubjects=(0,selectors.zoA)(state),originOfCurrentTab=(0,selectors.Tvv)(state),permittedAccountsByOrigin=(0,selectors.xe9)(state),selectedAddress=(0,selectors.GJg)(state),currentTabHasNoAccounts=!(null!==(_permittedAccountsByO=permittedAccountsByOrigin[originOfCurrentTab])&&void 0!==_permittedAccountsByO&&_permittedAccountsByO.length);let tabToConnect;return originOfCurrentTab&&currentTabHasNoAccounts&&!openMetaMaskTabs[id]&&(tabToConnect={origin:originOfCurrentTab}),{accountLabel:(0,selectors.ZHe)(state).name,connectedSubjects,subjects:(0,selectors.XFf)(state),mostRecentOverviewPage:(0,history_history.H7)(state),permittedAccountsByOrigin,selectedAddress,tabToConnect}}),(dispatch=>({getOpenMetamaskTabsIds:()=>dispatch((0,actions.vJj)()),disconnectAccount:(subjectKey,address)=>{dispatch((0,actions.LI8)(subjectKey,address))},disconnectAllAccounts:(subjectKey,subject)=>{const permissionMethodNames=Object.values(subject.permissions).map((({parentCapability})=>parentCapability));dispatch((0,actions.VQH)({[subjectKey]:permissionMethodNames}))},requestAccountsPermissionWithId:origin=>dispatch((0,actions.ul2)(origin))})),((stateProps,dispatchProps,ownProps)=>{const{connectedSubjects,subjects,mostRecentOverviewPage,selectedAddress,tabToConnect}=stateProps,{disconnectAccount,disconnectAllAccounts,requestAccountsPermissionWithId}=dispatchProps,{history}=ownProps,closePopover=()=>history.push(mostRecentOverviewPage);return{...ownProps,...stateProps,...dispatchProps,closePopover,disconnectAccount:subjectKey=>{disconnectAccount(subjectKey,selectedAddress),1===connectedSubjects.length&&closePopover()},disconnectAllAccounts:subjectKey=>{disconnectAllAccounts(subjectKey,subjects[subjectKey]),1===connectedSubjects.length&&closePopover()},requestAccountsPermission:async()=>{const id=await requestAccountsPermissionWithId(tabToConnect.origin);history.push(`${routes.X4}/${id}`)}}}))(ConnectedSites);var _DefaultStory$paramet,_DefaultStory$paramet2;const connected_sites_stories={title:"Pages/ConnectedSites"},PageSet=({children})=>children,DefaultStory=()=>react.createElement(PageSet,null,react.createElement(connected_sites_container,null));DefaultStory.storyName="Default",DefaultStory.parameters={...DefaultStory.parameters,docs:{...null===(_DefaultStory$paramet=DefaultStory.parameters)||void 0===_DefaultStory$paramet?void 0:_DefaultStory$paramet.docs,source:{originalSource:"() => {\n  return <PageSet>\n      <ConnectedSites />\n    </PageSet>;\n}",...null===(_DefaultStory$paramet2=DefaultStory.parameters)||void 0===_DefaultStory$paramet2||null===(_DefaultStory$paramet2=_DefaultStory$paramet2.docs)||void 0===_DefaultStory$paramet2?void 0:_DefaultStory$paramet2.source}}};const __namedExportsOrder=["DefaultStory"];DefaultStory.__docgenInfo={description:"",methods:[],displayName:"DefaultStory"}},"./ui/components/ui/site-origin/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>_site_origin__WEBPACK_IMPORTED_MODULE_0__.Z});var _site_origin__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ui/components/ui/site-origin/site-origin.js")},"./ui/components/ui/site-origin/site-origin.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>SiteOrigin});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_5__),classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),_chip__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ui/components/ui/chip/index.js"),_icon_with_fallback__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ui/components/ui/icon-with-fallback/index.js"),_helpers_constants_design_system__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ui/helpers/constants/design-system.ts");function SiteOrigin({siteOrigin,iconSrc,iconName,chip,className,title,leftIcon,rightIcon}){return react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:classnames__WEBPACK_IMPORTED_MODULE_1___default()("site-origin",className),title},chip?react__WEBPACK_IMPORTED_MODULE_0__.createElement(_chip__WEBPACK_IMPORTED_MODULE_2__.Z,{borderColor:_helpers_constants_design_system__WEBPACK_IMPORTED_MODULE_4__.kf.borderMuted,label:siteOrigin,maxContent:!1,leftIcon:leftIcon||react__WEBPACK_IMPORTED_MODULE_0__.createElement(_icon_with_fallback__WEBPACK_IMPORTED_MODULE_3__.Z,{icon:iconSrc,name:iconName,size:24}),rightIcon}):react__WEBPACK_IMPORTED_MODULE_0__.createElement("bdi",{dir:"ltr"},siteOrigin))}SiteOrigin.propTypes={siteOrigin:prop_types__WEBPACK_IMPORTED_MODULE_5___default().string.isRequired,iconName:prop_types__WEBPACK_IMPORTED_MODULE_5___default().string,iconSrc:prop_types__WEBPACK_IMPORTED_MODULE_5___default().string,className:prop_types__WEBPACK_IMPORTED_MODULE_5___default().string,title:prop_types__WEBPACK_IMPORTED_MODULE_5___default().string,chip:prop_types__WEBPACK_IMPORTED_MODULE_5___default().bool,leftIcon:prop_types__WEBPACK_IMPORTED_MODULE_5___default().node,rightIcon:prop_types__WEBPACK_IMPORTED_MODULE_5___default().node},SiteOrigin.__docgenInfo={description:"@deprecated The `<SiteOrigin />` component has been deprecated in favor of the new `<TagUrl>` component from the component-library.\nPlease update your code to use the new `<TagUrl>` component instead, which can be found at ui/components/component-library/tag-url/tag-url.js.\nYou can find documentation for the new `TagUrl` component in the MetaMask Storybook:\n{@link https://metamask.github.io/metamask-storybook/?path=/docs/components-componentlibrary-tagurl--docs}\nIf you would like to help with the replacement of the old `SiteOrigin` component, please submit a pull request against this GitHub issue:\n{@link https://github.com/MetaMask/metamask-extension/issues/20489}",methods:[],displayName:"SiteOrigin",props:{siteOrigin:{description:"The origin of the site generally the URL",type:{name:"string"},required:!0},iconName:{description:"Icon name is used for the fallback icon and will display the first letter of the string\nwhen iconSrc errors or is not provided.",type:{name:"string"},required:!1},iconSrc:{description:"The image src of the icon",type:{name:"string"},required:!1},className:{description:"Additional className added to the root html element",type:{name:"string"},required:!1},title:{description:"title specifies extra information and is added to a title attribute added to the root html element\nIt is most often shown as a tooltip text when the mouse moves over the element.",type:{name:"string"},required:!1},chip:{description:"Whether the SiteOrigin is displayed as a chip or plain text.\nif false iconSrc and iconName props will not be used.",type:{name:"bool"},required:!1},leftIcon:{description:"The icon to display on the left side of the chip. If not provided, the iconSrc and iconName will be used.",type:{name:"node"},required:!1},rightIcon:{description:"The icon to display on the right side of the chip.",type:{name:"node"},required:!1}}}}}]);