"use strict";(globalThis.webpackChunkmetamask_crx=globalThis.webpackChunkmetamask_crx||[]).push([[3521],{"./ui/components/app/name/name.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>Name});var react=__webpack_require__("./node_modules/react/index.js"),dist=__webpack_require__("./node_modules/@metamask/name-controller/dist/index.js"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),dist_browser=__webpack_require__("./node_modules/ethereumjs-util/dist.browser/index.js"),component_library=__webpack_require__("./ui/components/component-library/index.ts"),util=__webpack_require__("./ui/helpers/utils/util.js"),es=__webpack_require__("./node_modules/react-redux/es/index.js"),lodash=__webpack_require__("./node_modules/lodash/lodash.js"),selectors=__webpack_require__("./ui/selectors/index.js");function useName(value,type,variation){var _names$type;const names=(0,es.v9)(selectors.e3m,lodash.isEqual),chainId=(0,es.v9)(selectors.BVZ),normalizedValue=function normalizeValue(value,type){return type===dist.NameType.ETHEREUM_ADDRESS?value.toLowerCase():value}(value,type),typeVariationKey=function getVariationKey(type,chainId){return type===dist.NameType.ETHEREUM_ADDRESS?chainId:""}(type,chainId),variationKey=variation??typeVariationKey,nameEntry=null===(_names$type=names[type])||void 0===_names$type||null===(_names$type=_names$type[normalizedValue])||void 0===_names$type?void 0:_names$type[variationKey];return{name:(null==nameEntry?void 0:nameEntry.name)??null,sourceId:(null==nameEntry?void 0:nameEntry.sourceId)??null,proposedNames:(null==nameEntry?void 0:nameEntry.proposedNames)??{}}}var metametrics=__webpack_require__("./ui/contexts/metametrics.js"),constants_metametrics=__webpack_require__("./shared/constants/metametrics.ts"),deprecated=__webpack_require__("./ui/components/component-library/form-text-field/deprecated/index.js"),modal_content_deprecated=__webpack_require__("./ui/components/component-library/modal-content/deprecated/index.ts"),modal_header_deprecated=__webpack_require__("./ui/components/component-library/modal-header/deprecated/index.ts"),design_system=__webpack_require__("./ui/helpers/constants/design-system.ts"),form_combo_field=__webpack_require__("./ui/components/ui/form-combo-field/form-combo-field.tsx"),actions=__webpack_require__("./ui/store/actions.ts"),useCopyToClipboard=__webpack_require__("./ui/hooks/useCopyToClipboard.js"),i18n=__webpack_require__("./ui/contexts/i18n.js");const UPDATE_DELAY=2e3;function useProposedNames(value,type,chainId){const dispatch=(0,es.I0)(),{proposedNames}=useName(value,type),updateInterval=(0,react.useRef)(),[initialSources,setInitialSources]=(0,react.useState)();return(0,react.useEffect)((()=>{const reset=()=>{updateInterval.current&&clearInterval(updateInterval.current)},update=async()=>{const result=await dispatch((0,actions.pHl)({value,type,onlyUpdateAfterDelay:!0,variation:chainId}));initialSources||setInitialSources(function getInitialSources(proposedNamesResult,proposedNamesState){return[...Object.keys(proposedNamesResult).filter((sourceId=>{var _proposedNamesResult$;return null===(_proposedNamesResult$=proposedNamesResult[sourceId].proposedNames)||void 0===_proposedNamesResult$?void 0:_proposedNamesResult$.length})),...Object.keys(proposedNamesState).filter((sourceId=>{var _proposedNamesResult$2,_proposedNamesState$s;return!(null!==(_proposedNamesResult$2=proposedNamesResult[sourceId])&&void 0!==_proposedNamesResult$2&&_proposedNamesResult$2.proposedNames)&&(null===(_proposedNamesState$s=proposedNamesState[sourceId].proposedNames)||void 0===_proposedNamesState$s?void 0:_proposedNamesState$s.length)}))].sort()}((null==result?void 0:result.results)??{},proposedNames))};return reset(),update(),updateInterval.current=setInterval(update,UPDATE_DELAY),reset}),[value,type,chainId,dispatch,initialSources,setInitialSources]),{proposedNames,initialSources}}function NameDetails({onClose,type,value}){const chainId=(0,es.v9)(selectors.BVZ),{name:savedName,sourceId:savedSourceId}=useName(value,type),nameSources=(0,es.v9)(selectors.dgF,lodash.isEqual),[name,setName]=(0,react.useState)(""),[openMetricSent,setOpenMetricSent]=(0,react.useState)(!1),[selectedSourceId,setSelectedSourceId]=(0,react.useState)(),[selectedSourceName,setSelectedSourceName]=(0,react.useState)(),dispatch=(0,es.I0)(),t=(0,react.useContext)(i18n.OO),hasSavedName=Boolean(savedName),formattedValue=function formatValue(value,type){return type===dist.NameType.ETHEREUM_ADDRESS?(0,dist_browser.toChecksumAddress)(value):value}(value,type),{proposedNames,initialSources}=useProposedNames(value,type,chainId),[copiedAddress,handleCopyAddress]=(0,useCopyToClipboard.m)();(0,react.useEffect)((()=>{setName(savedName??""),setSelectedSourceId(savedSourceId??void 0),setSelectedSourceName(savedSourceId?savedName??void 0:void 0)}),[savedName,savedSourceId,setName,setSelectedSourceId]);const proposedNameOptions=(0,react.useMemo)((()=>function generateComboOptions(proposedNameEntries,nameSources){return Object.keys(proposedNameEntries).filter((sourceId=>{var _proposedNameEntries$;return null===(_proposedNameEntries$=proposedNameEntries[sourceId])||void 0===_proposedNameEntries$||null===(_proposedNameEntries$=_proposedNameEntries$.proposedNames)||void 0===_proposedNameEntries$?void 0:_proposedNameEntries$.length})).map((sourceId=>{var _proposedNameEntries$2;return((null===(_proposedNameEntries$2=proposedNameEntries[sourceId])||void 0===_proposedNameEntries$2?void 0:_proposedNameEntries$2.proposedNames)??[]).map((proposedName=>{var _nameSources$sourceId;return{primaryLabel:proposedName,secondaryLabel:(null===(_nameSources$sourceId=nameSources[sourceId])||void 0===_nameSources$sourceId?void 0:_nameSources$sourceId.label)??sourceId,sourceId}}))})).flat().sort(((a,b)=>a.secondaryLabel.toLowerCase().localeCompare(b.secondaryLabel.toLowerCase())))}(proposedNames,nameSources)),[proposedNames,nameSources]),{trackPetnamesOpenEvent,trackPetnamesSaveEvent}=function usePetnamesMetrics({initialSources,name,proposedNameOptions,savedName,savedSourceId,selectedSourceId,type}){const trackEvent=(0,react.useContext)(metametrics.Wd),trackPetnamesEvent=(0,react.useCallback)(((event,additionalProperties={})=>{const suggestedNameSources=[...new Set(proposedNameOptions.map((option=>option.sourceId)))],properties={petname_category:type,suggested_names_sources:suggestedNameSources,...additionalProperties};trackEvent({event,category:constants_metametrics.ci.Petnames,properties})}),[trackEvent,type,proposedNameOptions]),trackPetnamesSaveEvent=(0,react.useCallback)((()=>{const petnameSource=selectedSourceId??null,isDeleted=(null==savedName?void 0:savedName.length)&&!(null!=name&&name.length),isUpdated=(null==savedName?void 0:savedName.length)&&(null==name?void 0:name.length)&&name!==savedName,isCreated=!(null!=savedName&&savedName.length)&&(null==name?void 0:name.length);let event=null,additionalProperties={};isDeleted&&(event=constants_metametrics.AW.PetnameDeleted,additionalProperties={petname_previous_source:savedSourceId}),isUpdated&&(event=constants_metametrics.AW.PetnameUpdated,additionalProperties={petname_previous_source:savedSourceId,petname_source:petnameSource}),isCreated&&(event=constants_metametrics.AW.PetnameCreated,additionalProperties={petname_source:petnameSource}),event&&trackPetnamesEvent(event,additionalProperties)}),[trackPetnamesEvent,name,selectedSourceId,savedName,savedSourceId]);return{trackPetnamesOpenEvent:(0,react.useCallback)((()=>{trackPetnamesEvent(constants_metametrics.AW.PetnameModalOpened,{has_petname:Boolean(null==savedName?void 0:savedName.length),suggested_names_sources:initialSources})}),[trackPetnamesEvent,savedName,initialSources]),trackPetnamesSaveEvent}}({initialSources,name,proposedNameOptions,savedName,savedSourceId,selectedSourceId,type});(0,react.useEffect)((()=>{initialSources&&!openMetricSent&&(trackPetnamesOpenEvent(),setOpenMetricSent(!0))}),[initialSources,openMetricSent,trackPetnamesOpenEvent]);const handleSaveClick=(0,react.useCallback)((async()=>{trackPetnamesSaveEvent(),await dispatch((0,actions.qCp)({value,type,name:null!=name&&name.length?name:null,sourceId:selectedSourceId,variation:chainId})),onClose()}),[name,selectedSourceId,onClose,trackPetnamesSaveEvent,chainId]),handleClose=(0,react.useCallback)((()=>{onClose()}),[onClose]),handleNameChange=(0,react.useCallback)((newName=>{setName(newName),newName!==selectedSourceName&&(setSelectedSourceId(void 0),setSelectedSourceName(void 0))}),[setName,selectedSourceId]),handleProposedNameClick=(0,react.useCallback)((option=>{setSelectedSourceId(option.sourceId),setSelectedSourceName(option.primaryLabel)}),[setSelectedSourceId,setSelectedSourceName]),handleCopyClick=(0,react.useCallback)((()=>{handleCopyAddress(formattedValue)}),[handleCopyAddress,formattedValue]);return react.createElement(component_library.xu,null,react.createElement(component_library.u_,{isOpen:!0,onClose:handleClose},react.createElement(component_library.ZA,null),react.createElement(modal_content_deprecated.h,null,react.createElement(modal_header_deprecated.x,{onClose:handleClose,onBack:handleClose},t(hasSavedName?"nameModalTitleSaved":"nameModalTitleNew")),react.createElement("div",{style:{textAlign:"center",marginBottom:16,marginTop:8}},react.createElement(Name,{value,type:dist.NameType.ETHEREUM_ADDRESS,disableEdit:!0,internal:!0})),react.createElement(component_library.xv,{marginBottom:4,justifyContent:design_system.E0.spaceBetween},t(hasSavedName?"nameInstructionsSaved":"nameInstructionsNew")),react.createElement("hr",{className:"name-details__line"}),react.createElement(deprecated.X,{id:"address",className:"name-details__address",label:t("nameAddressLabel"),value:formattedValue,marginBottom:4,disabled:!0,endAccessory:react.createElement(component_library.Ei,{display:design_system.sS.Flex,iconName:copiedAddress?component_library.uH.CopySuccess:component_library.uH.Copy,size:component_library.hp.Sm,onClick:handleCopyClick,color:design_system.EY.iconMuted,ariaLabel:t("copyAddress")})}),react.createElement(component_library.__,{flexDirection:design_system.Qb.Column,alignItems:design_system.g1.flexStart,marginBottom:2,className:"name-details__display-name"},t("nameLabel"),react.createElement(form_combo_field.Z,{value:name,options:proposedNameOptions,placeholder:t("nameSetPlaceholder"),noOptionsText:t("nameNoProposedNames"),onChange:handleNameChange,onOptionClick:handleProposedNameClick})),react.createElement("hr",{className:"name-details__line"}),react.createElement(component_library.zx,{variant:component_library.Wu.Primary,startIconName:hasSavedName?void 0:component_library.uH.Save,width:design_system.Sw.Full,onClick:handleSaveClick},t(hasSavedName?"ok":"save")))))}try{namedetails.displayName="namedetails",namedetails.__docgenInfo={description:"",displayName:"namedetails",props:{onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},sourcePriority:{defaultValue:null,description:"",name:"sourcePriority",required:!1,type:{name:"string[]"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"NameType"}},value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["ui/components/app/name/name-details/name-details.tsx#namedetails"]={docgenInfo:namedetails.__docgenInfo,name:"namedetails",path:"ui/components/app/name/name-details/name-details.tsx#namedetails"})}catch(__react_docgen_typescript_loader_error){}function Name({value,type,disableEdit,internal}){const[modalOpen,setModalOpen]=(0,react.useState)(!1),trackEvent=(0,react.useContext)(metametrics.Wd),{name}=useName(value,type);(0,react.useEffect)((()=>{internal||trackEvent({event:constants_metametrics.AW.PetnameDisplayed,category:constants_metametrics.ci.Petnames,properties:{petname_category:type,has_petname:Boolean(null==name?void 0:name.length)}})}),[]);const handleClick=(0,react.useCallback)((()=>{setModalOpen(!0)}),[setModalOpen]),handleModalClose=(0,react.useCallback)((()=>{setModalOpen(!1)}),[setModalOpen]),formattedValue=function name_formatValue(value,type){return type===dist.NameType.ETHEREUM_ADDRESS?(0,util.$Q)((0,dist_browser.toChecksumAddress)(value)):value}(value,type),hasName=Boolean(name),iconName=hasName?component_library.uH.Save:component_library.uH.Warning;return react.createElement("div",null,!disableEdit&&modalOpen&&react.createElement(NameDetails,{value,type,onClose:handleModalClose}),react.createElement("div",{className:classnames_default()({name:!0,name__saved:hasName,name__missing:!hasName}),onClick:handleClick},react.createElement(component_library.JO,{name:iconName,className:"name__icon",size:component_library.Jh.Lg}),!hasName&&react.createElement("span",{className:"name__value"},formattedValue),hasName&&react.createElement("span",{className:"name__name"},name)))}try{name.displayName="name",name.__docgenInfo={description:"",displayName:"name",props:{disableEdit:{defaultValue:null,description:"Whether to prevent the modal from opening when the component is clicked.",name:"disableEdit",required:!1,type:{name:"boolean"}},internal:{defaultValue:null,description:"Whether this is being rendered inside the NameDetails modal.",name:"internal",required:!1,type:{name:"boolean"}},type:{defaultValue:null,description:"The type of value, e.g. NameType.ETHEREUM_ADDRESS",name:"type",required:!0,type:{name:"NameType"}},value:{defaultValue:null,description:"The raw value to display the name of.",name:"value",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["ui/components/app/name/name.tsx#name"]={docgenInfo:name.__docgenInfo,name:"name",path:"ui/components/app/name/name.tsx#name"})}catch(__react_docgen_typescript_loader_error){}},"./ui/components/ui/form-combo-field/form-combo-field.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>FormComboField});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),_component_library__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ui/components/component-library/index.ts"),_component_library_form_text_field_deprecated__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ui/components/component-library/form-text-field/deprecated/index.js"),_contexts_i18n__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./ui/contexts/i18n.js"),_helpers_constants_design_system__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./ui/helpers/constants/design-system.ts");function Option({option,onClick}){const handleClick=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),onClick(option)}),[onClick,option]),{primaryLabel,secondaryLabel}=option;return react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{tabIndex:0,className:"form-combo-field__option",onClick:handleClick},react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",{className:"form-combo-field__option-primary"},primaryLabel),secondaryLabel?react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",{className:"form-combo-field__option-secondary"},secondaryLabel):null)}function Dropdown({maxDropdownHeight,noOptionsText,onOptionClick,options,width}){const t=(0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(_contexts_i18n__WEBPACK_IMPORTED_MODULE_4__.OO),ref=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(),maxHeight=maxDropdownHeight??179,[dropdownHeight,setDropdownHeight]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(0);return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>{var _ref$current;setDropdownHeight((null===(_ref$current=ref.current)||void 0===_ref$current?void 0:_ref$current.scrollHeight)??0)})),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{ref,style:{width,maxHeight},className:classnames__WEBPACK_IMPORTED_MODULE_1___default()({"form-combo-field__dropdown":!0,"form-combo-field__dropdown__scroll":dropdownHeight>maxHeight})},0===options.length&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(Option,{option:{primaryLabel:noOptionsText??t("comboNoOptions")},onClick:()=>onOptionClick(void 0)}),options.map(((option,index)=>react__WEBPACK_IMPORTED_MODULE_0__.createElement(Option,{key:index,option,onClick:()=>{onOptionClick(option)}}))))}function FormComboField({maxDropdownHeight,noOptionsText,onChange,onOptionClick,options,placeholder,value}){const[dropdownVisible,setDropdownVisible]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1),valueRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(),[valueWidth,setValueWidth]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(0),inputRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),t=(0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(_contexts_i18n__WEBPACK_IMPORTED_MODULE_4__.OO);(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>{var _valueRef$current;setValueWidth(null===(_valueRef$current=valueRef.current)||void 0===_valueRef$current?void 0:_valueRef$current.offsetWidth)}));const handleBlur=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((e=>{var _e$relatedTarget;"form-combo-field__option"!==(null==e||null===(_e$relatedTarget=e.relatedTarget)||void 0===_e$relatedTarget?void 0:_e$relatedTarget.className)&&setDropdownVisible(!1)}),[setDropdownVisible]),handleChange=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((e=>{null==onChange||onChange(e.target.value)}),[onChange]),handleOptionClick=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((option=>{var _inputRef$current;setDropdownVisible(!1),option&&(handleChange({target:{value:option.primaryLabel}}),null==onOptionClick||onOptionClick(option)),null===(_inputRef$current=inputRef.current)||void 0===_inputRef$current||_inputRef$current.focus()}),[setDropdownVisible,handleChange]),handleClearClick=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((()=>{var _inputRef$current2;handleChange({target:{value:""}}),null===(_inputRef$current2=inputRef.current)||void 0===_inputRef$current2||_inputRef$current2.focus()}),[handleChange]);return react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"form-combo-field",ref:valueRef},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{onClick:()=>{setDropdownVisible(!0)}},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_component_library_form_text_field_deprecated__WEBPACK_IMPORTED_MODULE_3__.X,{autoFocus:!0,inputRef,placeholder,onBlur:handleBlur,onKeyUp:e=>{"Enter"===e.key&&handleBlur()},value,onChange:handleChange,className:classnames__WEBPACK_IMPORTED_MODULE_1___default()({"form-combo-field__value":!0,"form-combo-field__value-dropdown-visible":dropdownVisible}),endAccessory:react__WEBPACK_IMPORTED_MODULE_0__.createElement(_component_library__WEBPACK_IMPORTED_MODULE_2__.Ei,{display:_helpers_constants_design_system__WEBPACK_IMPORTED_MODULE_5__.sS.Flex,iconName:_component_library__WEBPACK_IMPORTED_MODULE_2__.uH.Close,size:_component_library__WEBPACK_IMPORTED_MODULE_2__.hp.Sm,onClick:()=>handleClearClick(),color:_helpers_constants_design_system__WEBPACK_IMPORTED_MODULE_5__.EY.iconMuted,ariaLabel:t("clear")})})),dropdownVisible&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(Dropdown,{maxDropdownHeight,noOptionsText,onOptionClick:handleOptionClick,options,width:valueWidth}))}try{formcombofield.displayName="formcombofield",formcombofield.__docgenInfo={description:"",displayName:"formcombofield",props:{maxDropdownHeight:{defaultValue:null,description:"The maximum height of the dropdown in pixels.",name:"maxDropdownHeight",required:!1,type:{name:"number"}},noOptionsText:{defaultValue:null,description:"The text to display in the dropdown when there are no options to display.",name:"noOptionsText",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"Callback function to invoke when the value changes.",name:"onChange",required:!1,type:{name:"((value: string) => void)"}},onOptionClick:{defaultValue:null,description:"Callback function to invoke when a dropdown option is clicked.",name:"onOptionClick",required:!1,type:{name:"((option: FormComboFieldOption) => void)"}},options:{defaultValue:null,description:"The options to display in the dropdown.\nAn array of objects with a 'primaryLabel' and optionally a 'secondaryLabel' property.`",name:"options",required:!0,type:{name:"FormComboFieldOption[]"}},placeholder:{defaultValue:null,description:"The placeholder text to display in the field when the value is empty.",name:"placeholder",required:!1,type:{name:"string"}},value:{defaultValue:null,description:"The value to display in the field.",name:"value",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["ui/components/ui/form-combo-field/form-combo-field.tsx#formcombofield"]={docgenInfo:formcombofield.__docgenInfo,name:"formcombofield",path:"ui/components/ui/form-combo-field/form-combo-field.tsx#formcombofield"})}catch(__react_docgen_typescript_loader_error){}}}]);