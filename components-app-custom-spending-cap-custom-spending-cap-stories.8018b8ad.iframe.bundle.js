(globalThis.webpackChunkmetamask_crx=globalThis.webpackChunkmetamask_crx||[]).push([[5198],{"./ui/components/app/custom-spending-cap/custom-spending-cap.stories.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DefaultStory:()=>DefaultStory,__namedExportsOrder:()=>__namedExportsOrder,default:()=>custom_spending_cap_stories});var react=__webpack_require__("./node_modules/react/index.js"),es=__webpack_require__("./node_modules/react-redux/es/index.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),bignumber=__webpack_require__("./node_modules/bignumber.js/bignumber.js"),bignumber_default=__webpack_require__.n(bignumber),dist_browser=__webpack_require__("./node_modules/ethereumjs-util/dist.browser/index.js"),i18n=__webpack_require__("./ui/contexts/i18n.js"),box=__webpack_require__("./ui/components/ui/box/index.js"),form_field=__webpack_require__("./ui/components/ui/form-field/index.js"),component_library=__webpack_require__("./ui/components/component-library/index.js"),design_system=__webpack_require__("./ui/helpers/constants/design-system.ts"),selectors=__webpack_require__("./ui/selectors/index.js"),app=__webpack_require__("./ui/ducks/app/app.ts"),transactions_controller_utils=__webpack_require__("./shared/lib/transactions-controller-utils.js"),conversion_utils=__webpack_require__("./shared/modules/conversion.utils.ts"),tokens=__webpack_require__("./shared/constants/tokens.js"),Numeric=__webpack_require__("./shared/modules/Numeric.ts"),actions=__webpack_require__("./ui/store/actions.ts"),swaps_utils=__webpack_require__("./shared/lib/swaps-utils.js"),transaction=__webpack_require__("./shared/constants/transaction.ts"),transaction_utils=__webpack_require__("./shared/modules/transaction.utils.js"),token_util=__webpack_require__("./ui/helpers/utils/token-util.js");var gasFee=__webpack_require__("./ui/contexts/gasFee.js"),tooltip=__webpack_require__("./ui/components/ui/tooltip/index.js");const CustomSpendingCapTooltip=({tooltipContentText,tooltipIcon})=>react.createElement(box.ZP,{display:design_system.bA.INLINE_BLOCK},react.createElement(tooltip.Z,{interactive:!0,position:"top",html:react.createElement(component_library.xv,{variant:design_system.rK.bodySm,as:"h6",margin:3,color:design_system.d9.textAlternative,className:"form-field__heading-title__tooltip"},tooltipContentText)},tooltipIcon?react.createElement(component_library.JO,{name:component_library.uH.Danger,className:"form-field__heading-title__tooltip__warning-icon",size:component_library.Jh.Inherit,style:{"vertical-align":"bottom"}}):""!==tooltipIcon&&react.createElement(component_library.JO,{name:component_library.uH.Question,size:component_library.Jh.Inherit})));function CustomSpendingCap({txParams,tokenName,currentTokenBalance,dappProposedValue,siteOrigin,passTheErrorText,decimals,setInputChangeInProgress}){const t=(0,react.useContext)(i18n.OO),dispatch=(0,es.I0)(),{updateTransaction}=(0,gasFee.YJ)(),inputRef=(0,react.useRef)(null),value=(0,es.v9)(selectors.UiF),[error,setError]=(0,react.useState)(""),[showUseDefaultButton,setShowUseDefaultButton]=(0,react.useState)(value!==String(dappProposedValue)&&!0),inputLogicEmptyStateText=t("inputLogicEmptyState"),replaceCommaToDot=inputValue=>inputValue.replace(/,/gu,"."),decConversionGreaterThan=(tokenValue,tokenBalance)=>new Numeric.D(Number(replaceCommaToDot(tokenValue)),10).greaterThan(Number(tokenBalance),10),getInputTextLogic=inputNumber=>new Numeric.D(Number(replaceCommaToDot(inputNumber)),10).lessThanOrEqualTo(new Numeric.D(Number(currentTokenBalance),10))?{className:"custom-spending-cap__lowerValue",description:t("inputLogicEqualOrSmallerNumber",[react.createElement(component_library.xv,{key:"custom-spending-cap",variant:design_system.rK.bodySmBold,as:"h6",className:"custom-spending-cap__input-value-and-token-name"},replaceCommaToDot(inputNumber)," ",tokenName)])}:decConversionGreaterThan(inputNumber,currentTokenBalance)?{className:"custom-spending-cap__higherValue",description:t("inputLogicHigherNumber")}:{className:"custom-spending-cap__emptyState",description:t("inputLogicEmptyState")},[customSpendingCapText,setCustomSpendingCapText]=(0,react.useState)(getInputTextLogic(value).description),handleChange=async valueInput=>{var _match$;if(!txParams)return;setInputChangeInProgress(!0);let spendingCapError="";const inputTextLogicDescription=getInputTextLogic(valueInput).description,match=tokens.BZ.exec(replaceCommaToDot(valueInput));if((null==match||null===(_match$=match[1])||void 0===_match$?void 0:_match$.length)>decimals)return void setInputChangeInProgress(!1);valueInput&&!tokens.d0.test(valueInput)?(spendingCapError=t("spendingCapError"),setCustomSpendingCapText(t("spendingCapErrorDescription",[siteOrigin])),setError(spendingCapError)):(setCustomSpendingCapText(inputTextLogicDescription),setError(""));const maxTokenAmount=(0,transactions_controller_utils.cp)(tokens.oc,decimals);if(Number(valueInput.length)>1&&Number(valueInput)){new(bignumber_default())(valueInput).greaterThan(maxTokenAmount)&&(spendingCapError=t("spendLimitTooLarge"),setError(spendingCapError))}dispatch((0,app.sA)(String(valueInput)));try{const newData=function getCustomTxParamsData(data,{customPermissionAmount,decimals}){const tokenData=(0,transaction_utils.I1)(data);if(!tokenData)throw new Error("Invalid data");if(tokenData.name!==transaction.iU.tokenMethodApprove)throw new Error(`Invalid data; should be 'approve' method, but instead is '${tokenData.name}'`);let spender=(0,token_util.Qn)(tokenData);spender.startsWith("0x")&&(spender=spender.substring(2));const[signature,tokenValue]=data.split(spender);if(!signature||!tokenValue)throw new Error("Invalid data");if(64!==tokenValue.length)throw new Error("Invalid token value; should be exactly 64 hex digits long (u256)");let customPermissionValue=(0,conversion_utils.X0)((0,swaps_utils.wg)(customPermissionAmount,decimals));if(customPermissionValue.length>64)throw new Error("Custom value is larger than u256");return customPermissionValue=customPermissionValue.padStart(tokenValue.length,"0"),`${signature}${spender}${customPermissionValue}`}(txParams.data,{customPermissionAmount:valueInput,decimals}),{from,to,value:txValue}=txParams,estimatedGasLimit=await(0,actions.QH8)({from,to,value:txValue,data:newData});estimatedGasLimit&&await updateTransaction({gasLimit:(0,conversion_utils.Z8)((0,dist_browser.addHexPrefix)(estimatedGasLimit))})}catch(exp){console.error("Error in trying to update gas limit",exp)}setInputChangeInProgress(!1)};(0,react.useEffect)((()=>{value!==String(dappProposedValue)&&setShowUseDefaultButton(!0)}),[value,dappProposedValue]),(0,react.useEffect)((()=>{passTheErrorText(error)}),[error,passTheErrorText]),(0,react.useEffect)((()=>{inputRef.current&&inputRef.current.focus({preventScroll:!0})}),[inputRef.current]);const chooseTooltipContentText=decConversionGreaterThan(value,currentTokenBalance)?t("warningTooltipText",[react.createElement(component_library.xv,{key:"tooltip-text",variant:design_system.rK.bodySmBold,as:"h6",color:design_system.d9.errorDefault},react.createElement(component_library.JO,{name:component_library.uH.Warning})," ",t("beCareful"))]):t("inputLogicEmptyState");return react.createElement(react.Fragment,null,react.createElement(box.ZP,{className:"custom-spending-cap",borderRadius:design_system.$u.SM,paddingTop:2,paddingRight:6,paddingLeft:6,display:design_system.bA.FLEX,alignItems:design_system.g1.flexStart,flexDirection:design_system.uM.COLUMN,backgroundColor:design_system.lP.backgroundAlternative,gap:2},react.createElement(box.ZP,{justifyContent:design_system.E0.center,display:design_system.bA.BLOCK,className:"custom-spending-cap__input"},react.createElement("label",{htmlFor:decConversionGreaterThan(value,currentTokenBalance)?"custom-spending-cap-input-value":"custom-spending-cap"},react.createElement(form_field.Z,{inputRef,dataTestId:"custom-spending-cap-input",wrappingLabelProps:{as:"div"},id:decConversionGreaterThan(value,currentTokenBalance)?"custom-spending-cap-input-value":"custom-spending-cap",TooltipCustomComponent:react.createElement(CustomSpendingCapTooltip,{tooltipContentText:replaceCommaToDot(value)?chooseTooltipContentText:"",tooltipIcon:replaceCommaToDot(value)?decConversionGreaterThan(value,currentTokenBalance):""}),onChange:handleChange,titleText:t("customSpendingCap"),placeholder:t("enterANumber"),error,value,titleDetail:showUseDefaultButton&&react.createElement(component_library.ZP,{size:design_system.$u.auto,onClick:e=>{e.preventDefault(),setShowUseDefaultButton(!1),handleChange(dappProposedValue)}},t("useDefault")),titleDetailWrapperProps:{marginBottom:2,marginRight:0}}),react.createElement(box.ZP,{width:design_system.D8.MAX,marginLeft:"auto",paddingRight:4,paddingBottom:2,textAlign:design_system.PH.End,className:classnames_default()("custom-spending-cap__max",{"custom-spending-cap__max--with-error-message":error})},react.createElement(component_library.ZP,{size:design_system.$u.auto,onClick:e=>{e.preventDefault(),handleChange(currentTokenBalance)}},t("max"))),react.createElement(box.ZP,{className:classnames_default()("custom-spending-cap__description",{"custom-spending-cap__description--with-error-message":error})},react.createElement(component_library.xv,{color:design_system.d9.textDefault,variant:design_system.rK.bodySm,as:"h6",paddingTop:2,paddingBottom:2},replaceCommaToDot(value)?customSpendingCapText:inputLogicEmptyStateText))))))}var _DefaultStory$paramet,_DefaultStory$paramet2,_DefaultStory$paramet3;CustomSpendingCapTooltip.propTypes={tooltipContentText:prop_types_default().oneOfType([prop_types_default().string,prop_types_default().node]),tooltipIcon:prop_types_default().oneOfType([prop_types_default().string,prop_types_default().bool])},CustomSpendingCapTooltip.__docgenInfo={description:"",methods:[],displayName:"CustomSpendingCapTooltip",props:{tooltipContentText:{description:"",type:{name:"union",value:[{name:"string"},{name:"node"}]},required:!1},tooltipIcon:{description:"",type:{name:"union",value:[{name:"string"},{name:"bool"}]},required:!1}}},CustomSpendingCap.propTypes={txParams:prop_types_default().object.isRequired,tokenName:prop_types_default().string,currentTokenBalance:prop_types_default().string,dappProposedValue:prop_types_default().string,siteOrigin:prop_types_default().string,passTheErrorText:prop_types_default().func,decimals:prop_types_default().string,setInputChangeInProgress:prop_types_default().func.isRequired},CustomSpendingCap.__docgenInfo={description:"",methods:[],displayName:"CustomSpendingCap",props:{txParams:{description:"Transaction params",type:{name:"object"},required:!0},tokenName:{description:"Displayed the token name currently tracked in description related to the input state",type:{name:"string"},required:!1},currentTokenBalance:{description:"The current token balance of the token",type:{name:"string"},required:!1},dappProposedValue:{description:"The dapp suggested amount",type:{name:"string"},required:!1},siteOrigin:{description:"The origin of the site generally the URL",type:{name:"string"},required:!1},passTheErrorText:{description:"Parent component's callback function passed in order to get the error text",type:{name:"func"},required:!1},decimals:{description:"Number of decimals",type:{name:"string"},required:!1},setInputChangeInProgress:{description:"Updating input state to changing",type:{name:"func"},required:!0}}};const custom_spending_cap_stories={title:"Components/App/CustomSpendingCap",argTypes:{tokenName:{control:{type:"text"}},currentTokenBalance:{control:{type:"number"}},dappProposedValue:{control:{type:"text"}},siteOrigin:{control:{type:"text"}},passTheErrorText:{action:"passTheErrorText"},decimals:{control:"text"}},args:{tokenName:"DAI",currentTokenBalance:200.12,dappProposedValue:"7",siteOrigin:"Uniswap.org",decimals:"4"}},DefaultStory=args=>react.createElement(CustomSpendingCap,args);DefaultStory.storyName="Default",DefaultStory.parameters={...DefaultStory.parameters,docs:{...null===(_DefaultStory$paramet=DefaultStory.parameters)||void 0===_DefaultStory$paramet?void 0:_DefaultStory$paramet.docs,source:{originalSource:"args => {\n  return <CustomSpendingCap {...args} />;\n}",...null===(_DefaultStory$paramet2=DefaultStory.parameters)||void 0===_DefaultStory$paramet2||null===(_DefaultStory$paramet3=_DefaultStory$paramet2.docs)||void 0===_DefaultStory$paramet3?void 0:_DefaultStory$paramet3.source}}};const __namedExportsOrder=["DefaultStory"];DefaultStory.__docgenInfo={description:"",methods:[],displayName:"DefaultStory"}},"./ui/components/ui/info-tooltip/info-tooltip-icon.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>InfoTooltipIcon});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_1__);function InfoTooltipIcon({fillColor="var(--color-icon-default)"}){return react__WEBPACK_IMPORTED_MODULE_0__.createElement("svg",{viewBox:"0 0 10 10",xmlns:"http://www.w3.org/2000/svg"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("path",{d:"M5 0C2.2 0 0 2.2 0 5s2.2 5 5 5 5-2.2 5-5-2.2-5-5-5zm0 2c.4 0 .7.3.7.7s-.3.7-.7.7-.7-.2-.7-.6.3-.8.7-.8zm.7 6H4.3V4.3h1.5V8z",fill:fillColor}))}InfoTooltipIcon.propTypes={fillColor:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string},InfoTooltipIcon.__docgenInfo={description:"",methods:[],displayName:"InfoTooltipIcon",props:{fillColor:{defaultValue:{value:"'var(--color-icon-default)'",computed:!1},description:"",type:{name:"string"},required:!1}}}},"./ui/components/ui/info-tooltip/info-tooltip.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>InfoTooltip});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_4__),classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),_tooltip__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ui/components/ui/tooltip/index.js"),_info_tooltip_icon__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./ui/components/ui/info-tooltip/info-tooltip-icon.js");const positionArrowClassMap={top:"info-tooltip__top-tooltip-arrow",bottom:"info-tooltip__bottom-tooltip-arrow",left:"info-tooltip__left-tooltip-arrow",right:"info-tooltip__right-tooltip-arrow"};function InfoTooltip({contentText="",position="",containerClassName,wrapperClassName,iconFillColor="var(--color-icon-alternative)"}){return react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"info-tooltip","data-testid":"info-tooltip"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_tooltip__WEBPACK_IMPORTED_MODULE_2__.Z,{interactive:!0,position,containerClassName:classnames__WEBPACK_IMPORTED_MODULE_1___default()("info-tooltip__tooltip-container",containerClassName),wrapperClassName,tooltipInnerClassName:"info-tooltip__tooltip-content",tooltipArrowClassName:positionArrowClassMap[position],html:contentText,theme:"tippy-tooltip-info"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_info_tooltip_icon__WEBPACK_IMPORTED_MODULE_3__.Z,{fillColor:iconFillColor})))}InfoTooltip.propTypes={contentText:prop_types__WEBPACK_IMPORTED_MODULE_4___default().node,position:prop_types__WEBPACK_IMPORTED_MODULE_4___default().oneOf(["top","left","bottom","right"]),containerClassName:prop_types__WEBPACK_IMPORTED_MODULE_4___default().string,wrapperClassName:prop_types__WEBPACK_IMPORTED_MODULE_4___default().string,iconFillColor:prop_types__WEBPACK_IMPORTED_MODULE_4___default().string},InfoTooltip.__docgenInfo={description:"",methods:[],displayName:"InfoTooltip",props:{contentText:{defaultValue:{value:"''",computed:!1},description:"Text label that shows up after hover",type:{name:"node"},required:!1},position:{defaultValue:{value:"''",computed:!1},description:"Shows position of the tooltip",type:{name:"enum",value:[{value:"'top'",computed:!1},{value:"'left'",computed:!1},{value:"'bottom'",computed:!1},{value:"'right'",computed:!1}]},required:!1},iconFillColor:{defaultValue:{value:"'var(--color-icon-alternative)'",computed:!1},description:"Add color for the icon",type:{name:"string"},required:!1},containerClassName:{description:"Add custom CSS class for container",type:{name:"string"},required:!1},wrapperClassName:{description:"Add custom CSS class for the wrapper",type:{name:"string"},required:!1}}}},"./ui/contexts/gasFee.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Po:()=>GasFeeContextProvider,YJ:()=>useGasFeeContext});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_2__),_hooks_gasFeeInput_useGasFeeInputs__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./ui/hooks/gasFeeInput/useGasFeeInputs.js");const GasFeeContext=(0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)({}),GasFeeContextProvider=({children,defaultEstimateToUse,transaction,minimumGasLimit,editGasMode})=>{const gasFeeDetails=(0,_hooks_gasFeeInput_useGasFeeInputs__WEBPACK_IMPORTED_MODULE_1__.a)(defaultEstimateToUse,transaction,minimumGasLimit,editGasMode);return react__WEBPACK_IMPORTED_MODULE_0__.createElement(GasFeeContext.Provider,{value:gasFeeDetails},children)};function useGasFeeContext(){return(0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(GasFeeContext)}GasFeeContextProvider.propTypes={children:prop_types__WEBPACK_IMPORTED_MODULE_2___default().node.isRequired,defaultEstimateToUse:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string,transaction:prop_types__WEBPACK_IMPORTED_MODULE_2___default().object,minimumGasLimit:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string,editGasMode:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string},GasFeeContextProvider.__docgenInfo={description:"",methods:[],displayName:"GasFeeContextProvider",props:{children:{description:"",type:{name:"node"},required:!0},defaultEstimateToUse:{description:"",type:{name:"string"},required:!1},transaction:{description:"",type:{name:"object"},required:!1},minimumGasLimit:{description:"",type:{name:"string"},required:!1},editGasMode:{description:"",type:{name:"string"},required:!1}}}},"./node_modules/lodash/isEqual.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseIsEqual=__webpack_require__("./node_modules/lodash/_baseIsEqual.js");module.exports=function isEqual(value,other){return baseIsEqual(value,other)}}}]);